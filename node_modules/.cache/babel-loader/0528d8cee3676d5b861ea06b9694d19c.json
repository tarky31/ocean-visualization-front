{"ast":null,"code":"import _objectSpread from \"D:/MyFile/WebCode/ocean-vis/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport { ref, watch } from 'vue';\nimport { NOOP } from '@vue/shared';\nimport { cloneDeep } from 'lodash-unified';\n\nfunction getFile(rawFile, uploadFiles) {\n  return uploadFiles.find(function (file) {\n    return file.uid === rawFile.uid;\n  });\n}\n\nfunction genUid(seed) {\n  return Date.now() + seed;\n}\n\nvar useHandlers = function useHandlers(props) {\n  var uploadFiles = ref([]);\n  var uploadRef = ref(null);\n  var tempIndex = 1;\n\n  function abort(file) {\n    uploadRef.value.abort(file);\n  }\n\n  function clearFiles() {\n    var status = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [\"ready\", \"uploading\", \"success\", \"fail\"];\n    uploadFiles.value = uploadFiles.value.filter(function (row) {\n      return !status.includes(row.status);\n    });\n  }\n\n  function handleError(err, rawFile) {\n    var file = getFile(rawFile, uploadFiles.value);\n    file.status = \"fail\";\n    uploadFiles.value.splice(uploadFiles.value.indexOf(file), 1);\n    props.onError(err, file, uploadFiles.value);\n    props.onChange(file, uploadFiles.value);\n  }\n\n  function handleProgress(ev, rawFile) {\n    var file = getFile(rawFile, uploadFiles.value);\n    props.onProgress(ev, file, uploadFiles.value);\n    file.status = \"uploading\";\n    file.percentage = ev.percent || 0;\n  }\n\n  function handleSuccess(res, rawFile) {\n    var file = getFile(rawFile, uploadFiles.value);\n\n    if (file) {\n      file.status = \"success\";\n      file.response = res;\n      props.onSuccess(res, file, uploadFiles.value);\n      props.onChange(file, uploadFiles.value);\n    }\n  }\n\n  function handleStart(rawFile) {\n    var uid = genUid(tempIndex++);\n    rawFile.uid = uid;\n    var file = {\n      name: rawFile.name,\n      percentage: 0,\n      status: \"ready\",\n      size: rawFile.size,\n      raw: rawFile,\n      uid: uid\n    };\n\n    if (props.listType === \"picture-card\" || props.listType === \"picture\") {\n      try {\n        file.url = URL.createObjectURL(rawFile);\n      } catch (err) {\n        console.error(\"[Element Error][Upload]\", err);\n        props.onError(err, file, uploadFiles.value);\n      }\n    }\n\n    uploadFiles.value.push(file);\n    props.onChange(file, uploadFiles.value);\n  }\n\n  function handleRemove(file, raw) {\n    if (raw) {\n      file = getFile(raw, uploadFiles.value);\n    }\n\n    var revokeObjectURL = function revokeObjectURL() {\n      if (file.url && file.url.indexOf(\"blob:\") === 0) {\n        URL.revokeObjectURL(file.url);\n      }\n    };\n\n    var doRemove = function doRemove() {\n      abort(file);\n      var fileList = uploadFiles.value;\n      fileList.splice(fileList.indexOf(file), 1);\n      props.onRemove(file, fileList);\n      revokeObjectURL();\n    };\n\n    if (!props.beforeRemove) {\n      doRemove();\n    } else if (typeof props.beforeRemove === \"function\") {\n      var before = props.beforeRemove(file, uploadFiles.value);\n\n      if (before instanceof Promise) {\n        before.then(function () {\n          doRemove();\n        }).catch(NOOP);\n      } else if (before !== false) {\n        doRemove();\n      }\n    }\n  }\n\n  function submit() {\n    uploadFiles.value.filter(function (file) {\n      return file.status === \"ready\";\n    }).forEach(function (file) {\n      uploadRef.value.upload(file.raw);\n    });\n  }\n\n  watch(function () {\n    return props.listType;\n  }, function (val) {\n    if (val === \"picture-card\" || val === \"picture\") {\n      uploadFiles.value = uploadFiles.value.map(function (file) {\n        if (!file.url && file.raw) {\n          try {\n            file.url = URL.createObjectURL(file.raw);\n          } catch (err) {\n            props.onError(err, file, uploadFiles.value);\n          }\n        }\n\n        return file;\n      });\n    }\n  });\n  watch(function () {\n    return props.fileList;\n  }, function (fileList) {\n    uploadFiles.value = fileList.map(function (file) {\n      var cloneFile = cloneDeep(file);\n      return _objectSpread(_objectSpread({}, cloneFile), {}, {\n        uid: file.uid || genUid(tempIndex++),\n        status: file.status || \"success\"\n      });\n    });\n  }, {\n    immediate: true,\n    deep: true\n  });\n  return {\n    abort: abort,\n    clearFiles: clearFiles,\n    handleError: handleError,\n    handleProgress: handleProgress,\n    handleStart: handleStart,\n    handleSuccess: handleSuccess,\n    handleRemove: handleRemove,\n    submit: submit,\n    uploadFiles: uploadFiles,\n    uploadRef: uploadRef\n  };\n};\n\nexport { useHandlers as default };","map":{"version":3,"mappings":"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","names":["getFile","rawFile","uploadFiles","find","file","uid","genUid","seed","Date","now","useHandlers","props","ref","uploadRef","tempIndex","abort","value","clearFiles","status","filter","row","includes","handleError","err","splice","indexOf","onError","onChange","handleProgress","ev","onProgress","percentage","percent","handleSuccess","res","response","onSuccess","handleStart","name","size","raw","listType","url","URL","createObjectURL","console","error","push","handleRemove","revokeObjectURL","doRemove","fileList","onRemove","beforeRemove","before","Promise","then","catch","NOOP","submit","forEach","upload","watch","val","map","cloneFile","cloneDeep","immediate","deep"],"sources":["../../../../../../packages/components/upload/src/useHandlers.ts"],"sourcesContent":["import { ref, watch } from 'vue'\nimport { NOOP } from '@vue/shared'\nimport { cloneDeep } from 'lodash-unified'\n\n// Inline types\nimport type {\n  ListType,\n  UploadFile,\n  UploadStatus,\n  ElFile,\n  ElUploadProgressEvent,\n  IUseHandlersProps,\n} from './upload.type'\ntype UploadRef = {\n  abort: (file: UploadFile) => void\n  upload: (file: ElFile) => void\n}\n// helpers\nfunction getFile(rawFile: ElFile, uploadFiles: UploadFile[]) {\n  return uploadFiles.find((file) => file.uid === rawFile.uid)\n}\n\nfunction genUid(seed: number) {\n  return Date.now() + seed\n}\n\nexport default (props: IUseHandlersProps) => {\n  const uploadFiles = ref<UploadFile[]>([])\n  const uploadRef = ref<UploadRef>(null)\n\n  let tempIndex = 1\n\n  function abort(file: UploadFile) {\n    uploadRef.value.abort(file)\n  }\n\n  function clearFiles(\n    status: UploadStatus[] = ['ready', 'uploading', 'success', 'fail']\n  ) {\n    uploadFiles.value = uploadFiles.value.filter((row) => {\n      return !status.includes(row.status)\n    })\n  }\n\n  function handleError(err: Error, rawFile: ElFile) {\n    const file = getFile(rawFile, uploadFiles.value)\n    file.status = 'fail'\n    uploadFiles.value.splice(uploadFiles.value.indexOf(file), 1)\n    props.onError(err, file, uploadFiles.value)\n    props.onChange(file, uploadFiles.value)\n  }\n\n  function handleProgress(ev: ElUploadProgressEvent, rawFile: ElFile) {\n    const file = getFile(rawFile, uploadFiles.value)\n    props.onProgress(ev, file, uploadFiles.value)\n    file.status = 'uploading'\n    file.percentage = ev.percent || 0\n  }\n\n  function handleSuccess(res: any, rawFile: ElFile) {\n    const file = getFile(rawFile, uploadFiles.value)\n    if (file) {\n      file.status = 'success'\n      file.response = res\n      props.onSuccess(res, file, uploadFiles.value)\n      props.onChange(file, uploadFiles.value)\n    }\n  }\n\n  function handleStart(rawFile: ElFile) {\n    const uid = genUid(tempIndex++)\n    rawFile.uid = uid\n    const file: UploadFile = {\n      name: rawFile.name,\n      percentage: 0,\n      status: 'ready',\n      size: rawFile.size,\n      raw: rawFile,\n      uid,\n    }\n    if (props.listType === 'picture-card' || props.listType === 'picture') {\n      try {\n        file.url = URL.createObjectURL(rawFile)\n      } catch (err) {\n        console.error('[Element Error][Upload]', err)\n        props.onError(err, file, uploadFiles.value)\n      }\n    }\n    uploadFiles.value.push(file)\n    props.onChange(file, uploadFiles.value)\n  }\n\n  function handleRemove(file: UploadFile, raw: ElFile) {\n    if (raw) {\n      file = getFile(raw, uploadFiles.value)\n    }\n    const revokeObjectURL = () => {\n      if (file.url && file.url.indexOf('blob:') === 0) {\n        URL.revokeObjectURL(file.url)\n      }\n    }\n    const doRemove = () => {\n      abort(file)\n      const fileList = uploadFiles.value\n      fileList.splice(fileList.indexOf(file), 1)\n      props.onRemove(file, fileList)\n      revokeObjectURL()\n    }\n    if (!props.beforeRemove) {\n      doRemove()\n    } else if (typeof props.beforeRemove === 'function') {\n      const before = props.beforeRemove(file, uploadFiles.value)\n      if (before instanceof Promise) {\n        before\n          .then(() => {\n            doRemove()\n          })\n          .catch(NOOP)\n      } else if (before !== false) {\n        doRemove()\n      }\n    }\n  }\n\n  function submit() {\n    uploadFiles.value\n      .filter((file) => file.status === 'ready')\n      .forEach((file) => {\n        uploadRef.value.upload(file.raw)\n      })\n  }\n\n  watch(\n    () => props.listType,\n    (val: ListType) => {\n      if (val === 'picture-card' || val === 'picture') {\n        uploadFiles.value = uploadFiles.value.map((file) => {\n          if (!file.url && file.raw) {\n            try {\n              file.url = URL.createObjectURL(file.raw)\n            } catch (err) {\n              props.onError(err, file, uploadFiles.value)\n            }\n          }\n          return file\n        })\n      }\n    }\n  )\n\n  watch(\n    () => props.fileList,\n    (fileList: UploadFile[]) => {\n      uploadFiles.value = fileList.map((file) => {\n        const cloneFile = cloneDeep(file)\n        return {\n          ...cloneFile,\n          uid: file.uid || genUid(tempIndex++),\n          status: file.status || 'success',\n        }\n      })\n    },\n    {\n      immediate: true,\n      deep: true,\n    }\n  )\n\n  return {\n    abort,\n    clearFiles,\n    handleError,\n    handleProgress,\n    handleStart,\n    handleSuccess,\n    handleRemove,\n    submit,\n    uploadFiles,\n    uploadRef,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}