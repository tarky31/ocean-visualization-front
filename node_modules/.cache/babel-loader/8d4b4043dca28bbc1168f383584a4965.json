{"ast":null,"code":"import _typeof from \"D:/MyFile/WebCode/ocean-vis/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport \"core-js/modules/es.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { h, render, watch, isVNode } from 'vue';\nimport { isClient } from '@vueuse/core';\nimport '../../../utils/index.mjs';\nimport MessageBoxConstructor from './index.mjs';\nimport { hasOwn, isString } from '@vue/shared';\nvar messageInstance = /* @__PURE__ */new Map();\n\nvar initInstance = function initInstance(props, container) {\n  var vnode = h(MessageBoxConstructor, props);\n  render(vnode, container);\n  document.body.appendChild(container.firstElementChild);\n  return vnode.component;\n};\n\nvar genContainer = function genContainer() {\n  return document.createElement(\"div\");\n};\n\nvar showMessage = function showMessage(options) {\n  var container = genContainer();\n\n  options.onVanish = function () {\n    render(null, container);\n    messageInstance.delete(vm);\n  };\n\n  options.onAction = function (action) {\n    var currentMsg = messageInstance.get(vm);\n    var resolve;\n\n    if (options.showInput) {\n      resolve = {\n        value: vm.inputValue,\n        action: action\n      };\n    } else {\n      resolve = action;\n    }\n\n    if (options.callback) {\n      options.callback(resolve, instance.proxy);\n    } else {\n      if (action === \"cancel\" || action === \"close\") {\n        if (options.distinguishCancelAndClose && action !== \"cancel\") {\n          currentMsg.reject(\"close\");\n        } else {\n          currentMsg.reject(\"cancel\");\n        }\n      } else {\n        currentMsg.resolve(resolve);\n      }\n    }\n  };\n\n  var instance = initInstance(options, container);\n  var vm = instance.proxy;\n\n  for (var prop in options) {\n    if (hasOwn(options, prop) && !hasOwn(vm.$props, prop)) {\n      vm[prop] = options[prop];\n    }\n  }\n\n  watch(function () {\n    return vm.message;\n  }, function (newVal, oldVal) {\n    if (isVNode(newVal)) {\n      instance.slots.default = function () {\n        return [newVal];\n      };\n    } else if (isVNode(oldVal) && !isVNode(newVal)) {\n      delete instance.slots.default;\n    }\n  }, {\n    immediate: true\n  });\n  vm.visible = true;\n  return vm;\n};\n\nfunction MessageBox(options) {\n  if (!isClient) return;\n  var callback;\n\n  if (isString(options) || isVNode(options)) {\n    options = {\n      message: options\n    };\n  } else {\n    callback = options.callback;\n  }\n\n  return new Promise(function (resolve, reject) {\n    var vm = showMessage(options);\n    messageInstance.set(vm, {\n      options: options,\n      callback: callback,\n      resolve: resolve,\n      reject: reject\n    });\n  });\n}\n\nMessageBox.alert = function (message, title, options) {\n  if (_typeof(title) === \"object\") {\n    options = title;\n    title = \"\";\n  } else if (title === void 0) {\n    title = \"\";\n  }\n\n  return MessageBox(Object.assign({\n    title: title,\n    message: message,\n    type: \"\",\n    closeOnPressEscape: false,\n    closeOnClickModal: false\n  }, options, {\n    boxType: \"alert\"\n  }));\n};\n\nMessageBox.confirm = function (message, title, options) {\n  if (_typeof(title) === \"object\") {\n    options = title;\n    title = \"\";\n  } else if (title === void 0) {\n    title = \"\";\n  }\n\n  return MessageBox(Object.assign({\n    title: title,\n    message: message,\n    type: \"\",\n    showCancelButton: true\n  }, options, {\n    boxType: \"confirm\"\n  }));\n};\n\nMessageBox.prompt = function (message, title, options) {\n  if (_typeof(title) === \"object\") {\n    options = title;\n    title = \"\";\n  } else if (title === void 0) {\n    title = \"\";\n  }\n\n  return MessageBox(Object.assign({\n    title: title,\n    message: message,\n    showCancelButton: true,\n    showInput: true,\n    type: \"\"\n  }, options, {\n    boxType: \"prompt\"\n  }));\n};\n\nMessageBox.close = function () {\n  messageInstance.forEach(function (_, vm) {\n    vm.doClose();\n  });\n  messageInstance.clear();\n};\n\nexport { MessageBox as default };","map":{"version":3,"mappings":"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","names":["messageInstance","Map","initInstance","props","container","vnode","h","MessageBoxConstructor","render","document","body","appendChild","firstElementChild","component","genContainer","createElement","showMessage","options","onVanish","delete","vm","onAction","action","currentMsg","get","resolve","showInput","value","inputValue","callback","instance","proxy","distinguishCancelAndClose","reject","prop","hasOwn","$props","watch","message","newVal","oldVal","isVNode","slots","default","immediate","visible","MessageBox","isClient","isString","Promise","set","alert","title","Object","assign","type","closeOnPressEscape","closeOnClickModal","boxType","confirm","showCancelButton","prompt","close","forEach","_","doClose","clear"],"sources":["../../../../../../packages/components/message-box/src/messageBox.ts"],"sourcesContent":["import { h, watch, render } from 'vue'\nimport { isClient } from '@vueuse/core'\nimport { isVNode, isString, hasOwn } from '@element-plus/utils'\nimport MessageBoxConstructor from './index.vue'\n\nimport type { ComponentPublicInstance, VNode } from 'vue'\nimport type {\n  Action,\n  Callback,\n  MessageBoxState,\n  IElMessageBox,\n  ElMessageBoxOptions,\n  MessageBoxData,\n} from './message-box.type'\n\n// component default merge props & data\n\nconst messageInstance = new Map<\n  ComponentPublicInstance<{ doClose: () => void }>, // marking doClose as function\n  {\n    options: any\n    callback: Callback\n    resolve: (res: any) => void\n    reject: (reason?: any) => void\n  }\n>()\n\nconst initInstance = (props: any, container: HTMLElement) => {\n  const vnode = h(MessageBoxConstructor, props)\n  render(vnode, container)\n  document.body.appendChild(container.firstElementChild)\n  return vnode.component\n}\n\nconst genContainer = () => {\n  return document.createElement('div')\n}\n\nconst showMessage = (options: any) => {\n  const container = genContainer()\n  // Adding destruct method.\n  // when transition leaves emitting `vanish` evt. so that we can do the clean job.\n  options.onVanish = () => {\n    // not sure if this causes mem leak, need proof to verify that.\n    // maybe calling out like 1000 msg-box then close them all.\n    render(null, container)\n    messageInstance.delete(vm) // Remove vm to avoid mem leak.\n    // here we were suppose to call document.body.removeChild(container.firstElementChild)\n    // but render(null, container) did that job for us. so that we do not call that directly\n  }\n\n  options.onAction = (action: Action) => {\n    const currentMsg = messageInstance.get(vm)\n    let resolve: Action | { value: string; action: Action }\n    if (options.showInput) {\n      resolve = { value: vm.inputValue, action }\n    } else {\n      resolve = action\n    }\n    if (options.callback) {\n      options.callback(resolve, instance.proxy)\n    } else {\n      if (action === 'cancel' || action === 'close') {\n        if (options.distinguishCancelAndClose && action !== 'cancel') {\n          currentMsg.reject('close')\n        } else {\n          currentMsg.reject('cancel')\n        }\n      } else {\n        currentMsg.resolve(resolve)\n      }\n    }\n  }\n\n  const instance = initInstance(options, container)\n\n  // This is how we use message box programmably.\n  // Maybe consider releasing a template version?\n  // get component instance like v2.\n  const vm = instance.proxy as ComponentPublicInstance<\n    {\n      visible: boolean\n      doClose: () => void\n    } & MessageBoxState\n  >\n\n  for (const prop in options) {\n    if (hasOwn(options, prop) && !hasOwn(vm.$props, prop)) {\n      vm[prop as string] = options[prop]\n    }\n  }\n\n  watch(\n    () => vm.message,\n    (newVal, oldVal) => {\n      if (isVNode(newVal)) {\n        // Override slots since message is vnode type.\n        instance.slots.default = () => [newVal]\n      } else if (isVNode(oldVal) && !isVNode(newVal)) {\n        delete instance.slots.default\n      }\n    },\n    {\n      immediate: true,\n    }\n  )\n\n  // change visibility after everything is settled\n  vm.visible = true\n  return vm\n}\n\nasync function MessageBox(options: ElMessageBoxOptions): Promise<MessageBoxData>\nfunction MessageBox(\n  options: ElMessageBoxOptions | string | VNode\n): Promise<{ value: string; action: Action } | Action> {\n  if (!isClient) return\n  let callback\n  if (isString(options) || isVNode(options)) {\n    options = {\n      message: options,\n    }\n  } else {\n    callback = options.callback\n  }\n\n  return new Promise((resolve, reject) => {\n    const vm = showMessage(options)\n    // collect this vm in order to handle upcoming events.\n    messageInstance.set(vm, {\n      options,\n      callback,\n      resolve,\n      reject,\n    })\n  })\n}\n\nMessageBox.alert = (\n  message: string,\n  title: string,\n  options?: ElMessageBoxOptions\n) => {\n  if (typeof title === 'object') {\n    options = title\n    title = ''\n  } else if (title === undefined) {\n    title = ''\n  }\n\n  return MessageBox(\n    Object.assign(\n      {\n        title,\n        message,\n        type: '',\n        closeOnPressEscape: false,\n        closeOnClickModal: false,\n      },\n      options,\n      {\n        boxType: 'alert',\n      }\n    )\n  )\n}\n\nMessageBox.confirm = (\n  message: string,\n  title: string,\n  options?: ElMessageBoxOptions\n) => {\n  if (typeof title === 'object') {\n    options = title\n    title = ''\n  } else if (title === undefined) {\n    title = ''\n  }\n  return MessageBox(\n    Object.assign(\n      {\n        title,\n        message,\n        type: '',\n        showCancelButton: true,\n      },\n      options,\n      {\n        boxType: 'confirm',\n      }\n    )\n  )\n}\n\nMessageBox.prompt = (\n  message: string,\n  title: string,\n  options?: ElMessageBoxOptions\n) => {\n  if (typeof title === 'object') {\n    options = title\n    title = ''\n  } else if (title === undefined) {\n    title = ''\n  }\n  return MessageBox(\n    Object.assign(\n      {\n        title,\n        message,\n        showCancelButton: true,\n        showInput: true,\n        type: '',\n      },\n      options,\n      {\n        boxType: 'prompt',\n      }\n    )\n  )\n}\n\nMessageBox.close = () => {\n  // instance.setupInstall.doClose()\n  // instance.setupInstall.state.visible = false\n\n  messageInstance.forEach((_, vm) => {\n    vm.doClose()\n  })\n\n  messageInstance.clear()\n}\n\nexport default MessageBox as IElMessageBox\n"]},"metadata":{},"sourceType":"module"}