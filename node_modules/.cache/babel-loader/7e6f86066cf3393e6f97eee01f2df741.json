{"ast":null,"code":"import _asyncToGenerator from \"D:/MyFile/WebCode/ocean-vis2/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _Loading2 from \"element-ui/lib/theme-chalk/loading.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Loading from \"element-ui/lib/loading\";\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.object.to-string.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport OceanMap from \"../src/components/Map\";\nimport \"ol/ol.css\";\nimport Map from \"ol/Map\";\nimport View from \"ol/View\";\nimport TileLayer from \"ol/layer/Tile\";\nimport XYZ from \"ol/source/XYZ\";\nimport ScaleLine from \"ol/control/ScaleLine\";\nimport MousePosition from \"ol/control/MousePosition\";\nimport { fromLonLat } from \"ol/proj\";\nimport 'ol/ol.css';\nimport ImageWMS from 'ol/source/ImageWMS';\nimport OSM from 'ol/source/OSM'; //import {Image as ImageLayer, Tile as TileLayer} from 'ol/layer';\n\nimport TileWMS from \"ol/source/TileWMS\"; // import Control from 'ol/control';\n// import {Control, defaults as defaultControls} from 'ol/control';\n\nimport { OverviewMap, defaults as defaultControls } from \"ol/control\";\nimport { format } from \"ol/coordinate\";\nexport default {\n  data: function data() {\n    return {\n      value1: '',\n      //日期\n      value2: '',\n      //时刻\n      radio: \"\",\n      //选择的属性\n      sshList: [],\n      tempList: [],\n      swhList: [],\n      waveList: [],\n      mylayer: \"\",\n      radios: ['ssh', 'temperature', 'swh', 'wave_direction'],\n      select1: [\"Real\", \"pred\", \"Corr\", \"Error_Before\", \"Error_After\"],\n      select2: [\"Fore\", \"pred\", \"Re\", \"Re-fore\", \"Re-pred\"],\n      listDic: ['v1', 'v2', 'v3', 'v4', 'v5'],\n      middle_names: [],\n      maps: [],\n      wmsLayers: [],\n      addedLayer: []\n    };\n  },\n  components: {\n    OceanMap: OceanMap\n  },\n  methods: {\n    getLocalTime: function getLocalTime(nS) {\n      return new Date(parseInt(nS) * 1000).toLocaleString().replace(/:\\d{1,2}$/, ' ');\n    },\n    fileSubmit: function fileSubmit() {\n      var _this2 = this;\n\n      this.$MessageBox.alert('请将nc文件放置到home/user_ocean_data,然后点击确定', '提示', {\n        confirmButtonText: '确定',\n        callback: function callback(action) {\n          if (action === 'confirm') {\n            var loadOption = _Loading.service({\n              fullscreen: true,\n              lock: true,\n              text: '正在处理中',\n              spinner: 'el-icon-loading',\n              background: 'rgba(0, 0, 0, 0.7)'\n            });\n\n            _this2.$http.get(\"api/ocean/processOceanData\").then(function (response) {\n              // console.log(response)\n              var state = response.data.success;\n\n              if (state === true) {\n                loadOption.close();\n              }\n            });\n          }\n        }\n      });\n    },\n    initMap: function initMap(id) {\n      //   console.log(\"hello\")\n      var tdtLayer = new TileLayer({\n        title: \"谷歌矢量地图服务\",\n        source: new XYZ({\n          // arcgis server\n          url: 'http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}'\n        })\n      });\n      var map = new Map({\n        target: document.getElementsByClassName('map')[id],\n        // 关联到对应的div容器\n        layers: [tdtLayer],\n        view: new View({\n          // 地图视图\n          projection: 'EPSG:4326',\n          center: [113, 12],\n          zoom: 4\n        }),\n        controls: defaultControls().extend([new ScaleLine({\n          //设置度量单位为米\n          units: 'metric',\n          target: 'scalebar',\n          className: 'ol-scale-line1'\n        }), new MousePosition({\n          coordinateFormat: function coordinateFormat(coordinate) {\n            return format(coordinate, '经度:{x} 纬度:{y}', 2);\n          },\n          projection: 'EPSG:4326',\n          className: 'custom-mouse-position',\n          target: document.getElementsByClassName('lnglat')[id],\n          undefinedHTML: '&nbsp;'\n        })])\n      });\n      this.maps.push(map);\n      this.showInfo(id);\n    },\n    showInfo: function showInfo(id) {\n      var _this = this;\n\n      _this.maps[id].on(\"moveend\", function (e) {\n        var value = \"Scale 1 : \" + document.getElementsByClassName(\"ol-scale-line1-inner\")[id].innerHTML;\n        document.getElementsByClassName(\"scale\")[id].innerHTML = value;\n\n        var extent = _this.maps[id].getView().calculateExtent();\n\n        var geLng = (extent[2] - extent[0]) / 5;\n        var geLat = (extent[3] - extent[1]) / 5;\n        var su = \"\",\n            heng = \"\";\n\n        for (var i = 0; i < 5; i++) {\n          su += \"<div class=\\\"kedu1\\\"><span>\".concat((geLat * i + extent[1]).toFixed(1), \"</span></div>\");\n          heng += \"<div class=\\\"kedu2\\\"><span>\".concat((geLng * i + extent[0]).toFixed(1), \"</span></div>\");\n        }\n\n        document.getElementsByClassName(\"left\")[id].innerHTML = su; // $(\"#mapPanel1 .left\").html(su);\n\n        document.getElementsByClassName(\"top1\")[id].innerHTML = heng; // $(\".top1\").html(heng)\n      });\n\n      this.maps[id].on('singleclick', /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(e) {\n          var coor, bbox, viewResolution, url, data, result;\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  coor = e.coordinate;\n                  bbox = coor[0] - 2 + \",\" + (coor[1] - 2) + \",\" + (coor[0] + 2) + \",\" + (coor[1] + 2);\n                  viewResolution = _this.maps[id].getView().getResolution();\n                  url = _this.wmsLayers[id].getSource().getFeatureInfoUrl(coor, viewResolution, \"EPSG:4326\", {\n                    INFO_FORMAT: \"application/json\",\n                    //输出为json字符串\n                    VERSION: '1.1.1',\n                    FORMAT: 'image/png'\n                  });\n\n                  if (!url) {\n                    _context.next = 11;\n                    break;\n                  }\n\n                  _context.next = 7;\n                  return fetch(url).then(function (res) {\n                    return res.text(); //返回Promise\n                  });\n\n                case 7:\n                  data = _context.sent;\n                  data = JSON.parse(data);\n                  result = data.features[0].properties.GRAY_INDEX.toFixed(4);\n                  document.getElementsByClassName(\"mapval\")[id].innerHTML = result;\n\n                case 11:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    },\n    getMiddle: function getMiddle(arr, select) {\n      var flags = [false, false, false, false, false];\n\n      for (var i = 0; i < arr.length; i++) {\n        var index = this.listDic.indexOf(arr[i]);\n        flags[index] = true;\n        this.middle_names.push(select[index]);\n      }\n\n      for (var _i = 0; _i < flags.length; _i++) {\n        if (!flags[_i]) {\n          this.middle_names.push(select[_i]);\n        }\n      }\n    },\n    draw: function draw() {\n      this.middle_names = [];\n\n      if (this.value1 === '' || this.value2 === '') {\n        alert(\"请选择日期，时间\");\n        return;\n      } else if (this.radio === '') {\n        alert(\"请勾选海洋要素数值！\");\n      } else {\n        var type = this.radio;\n        var isEmpty = false;\n        var list = null;\n\n        if (type == 'ssh') {\n          if (this.sshList.length === 0) {\n            isEmpty = true;\n          } else {\n            list = this.sshList;\n            this.getMiddle(list, this.select1);\n          }\n        } else if (type == 'temperature') {\n          if (this.tempList.length === 0) {\n            isEmpty = true;\n          } else {\n            list = this.tempList;\n            this.getMiddle(list, this.select1);\n          }\n        } else if (type == 'swh') {\n          if (this.swhList.length === 0) {\n            isEmpty = true;\n          } else {\n            list = this.swhList;\n            this.getMiddle(list, this.select1);\n          }\n        } else if (type == 'wave_direction') {\n          if (this.waveList.length === 0) {\n            isEmpty = true;\n          } else {\n            list = this.waveList;\n            this.getMiddle(list, this.select2);\n          }\n        }\n\n        console.log(this.middle_names);\n\n        if (isEmpty) {\n          alert(\"请勾选有单选框的复选框选项\");\n          return;\n        } else {\n          var riqi = this.value1 + \" \" + this.value2;\n          var shijianchuo = new Date(riqi).getTime(); //时间戳\n\n          for (var i = 0; i < this.wmsLayers.length; i++) {\n            //清空所有图层\n            this.maps[i] && this.maps[i].removeLayer(this.wmsLayers[i]);\n          }\n\n          this.wmsLayers = [];\n\n          for (var _i2 = 0; _i2 < 5; _i2++) {\n            var map = this.maps[_i2];\n            var middle_name = this.middle_names[_i2];\n            var first_name = this.radio.toUpperCase();\n            var name = first_name + \"_\" + middle_name + \"_\" + shijianchuo;\n            this.mylayer = 'tif2022:' + name; // console.log('433'+name)\n            // console.log(this.$refs.map1.innerHTML)\n\n            document.getElementsByClassName(\"maptitle\")[_i2].innerHTML = first_name + \"_\" + middle_name;\n            this.init(name, map, _i2);\n          }\n        }\n      }\n    },\n    getRadio: function getRadio() {\n      this.sshList = [];\n      this.tempList = [];\n      this.swhList = [];\n      this.waveList = [];\n    },\n    //  渲染图层\n    init: function init(titleName, map, index) {\n      this.addedLayer = mylayer; //层的名字\n\n      var tileWMS = new TileWMS({\n        url: \"vector/geoserver/tif2022/wms\",\n        // Layers需要指定要显示的图层名\n        params: {\n          LAYERS: this.mylayer,\n          TILED: true,\n          VERSION: '1.1.1',\n          FORMAT: 'image/png'\n        },\n        // serverType明显为geoserver\n        serverType: \"geoserver\",\n        // Countries have transparency, so do not fade tiles:\n        transition: 0\n      });\n      var layers = new TileLayer({\n        source: tileWMS\n      });\n      this.wmsLayers.push(layers);\n      map.addLayer(layers);\n    }\n  },\n  mounted: function mounted() {\n    for (var i = 0; i < 5; i++) {\n      this.initMap(i);\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA,gC,CACA;;AAEA,wC,CAEA;AACA;;AACA;AACA;AACA;AACAA,MADA,kBACA;AACA;AACAC,gBADA;AACA;AACAC,gBAFA;AAEA;AACAC,eAHA;AAGA;AACAC,iBAJA;AAKAC,kBALA;AAMAC,iBANA;AAOAC,kBAPA;AAQAC,iBARA;AASAC,6DATA;AAUAC,sEAVA;AAWAC,2DAXA;AAYAC,6CAZA;AAaAC,sBAbA;AAcAC,cAdA;AAeAC,mBAfA;AAgBAC;AAhBA;AAkBA,GApBA;AAqBAC;AACAC;AADA,GArBA;AAwBAC;AAEAC,gBAFA,wBAEAC,EAFA,EAEA;AACA;AACA,KAJA;AAKAC,cALA,wBAKA;AAAA;;AACA;AACAC,+BADA;AAEAC;AACA;AACA;AACAC,8BADA;AAEAC,wBAFA;AAGAC,2BAHA;AAIAC,wCAJA;AAKAC;AALA;;AAMA,2DACAC,IADA,CACA;AACA;AACA;;AACA;AACAC;AACA;AACA,aAPA;AASA;AACA;AApBA;AAsBA,KA5BA;AA8BAC,WA9BA,mBA8BAC,EA9BA,EA8BA;AACA;AACA;AACAC,yBADA;AAEAC;AACA;AACAC;AAFA;AAFA;AAOA;AACAC,0DADA;AACA;AACAC,iBACAC,QADA,CAFA;AAKAC;AAAA;AACAC,iCADA;AAEAC,2BAFA;AAGAC;AAHA,UALA;AAUAC,4CACA;AACA;AACAC,yBAFA;AAGAR,4BAHA;AAIAS;AAJA,UADA,EAOA;AACAC;AACA;AACA,WAHA;AAIAN,iCAJA;AAKAK,4CALA;AAMAT,+DANA;AAOAW;AAPA,UAPA;AAVA;AA4BA;AACA;AACA,KArEA;AAuEAC,YAvEA,oBAuEAhB,EAvEA,EAuEA;AACA;;AACAiB;AACA;AACAC;;AACA;;AACA;AACA;AACA;AAAA;;AACA;AACAC;AACAC;AACA;;AACAF,mEAXA,CAYA;;AACAA,qEAbA,CAcA;AACA,OAfA;;AAiBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACAG,sBADA,GACAC,YADA;AAEAC,sBAFA,GAEAF,6EAFA;AAGAG,gCAHA,GAGAP,wCAHA;AAIAd,qBAJA,GAIAc,oBACAQ,SADA,GAEAC,iBAFA,CAEAL,IAFA,EAEAG,cAFA,EAEA,WAFA,EAEA;AACAG,mDADA;AACA;AACAC,oCAFA;AAGAC;AAHA,mBAFA,CAJA;;AAAA,uBAWA1B,GAXA;AAAA;AAAA;AAAA;;AAAA;AAAA,yBAYA2B;AACA,sCADA,CACA;AACA,mBAFA,CAZA;;AAAA;AAYA/D,sBAZA;AAeAA;AACAgE,wBAhBA,GAgBAhE,iDAhBA;AAiBAmD;;AAjBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAoBA,KA9GA;AA+GAc,aA/GA,qBA+GAC,GA/GA,EA+GAC,MA/GA,EA+GA;AACA;;AACA;AACA;AACAC;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA,KA3HA;AA6HAC,QA7HA,kBA6HA;AACA;;AACA;AACAC;AACA;AACA,OAHA,MAGA;AACAA;AACA,OAFA,MAEA;AACA;AACA;AACA;;AACA;AACA;AACAC;AACA,WAFA,MAEA;AACAC;AACA;AAEA;AACA,SARA,MAQA;AACA;AACAD;AACA,WAFA,MAEA;AACAC;AACA;AACA;AACA,SAPA,MAOA;AACA;AACAD;AACA,WAFA,MAEA;AACAC;AACA;AACA;AACA,SAPA,MAOA;AACA;AACAD;AACA,WAFA,MAEA;AACAC;AACA;AACA;AACA;;AACAC;;AACA;AACAH;AACA;AACA,SAHA,MAGA;AACA;AACA,qDAFA,CAEA;;AACA;AAAA;AACA;AACA;;AACA;;AACA;AACA;AACA;AACA;AACA;AAEA,6CANA,CAOA;AACA;;AACAnB;AACA;AACA;AACA;AACA;AACA,KA/LA;AAkMAuB,YAlMA,sBAkMA;AACA;AACA;AACA;AACA;AACA,KAvMA;AAwMA;AACAC,QAzMA,gBAyMAC,SAzMA,EAyMAC,GAzMA,EAyMAC,KAzMA,EAyMA;AAEA,gCAFA,CAEA;;AAEA;AACA1C,2CADA;AAEA;AACA2C;AACAC,8BADA;AAEAC,qBAFA;AAGApB,0BAHA;AAIAC;AAJA,SAHA;AAQA;AACAoB,+BATA;AAUA;AACAC;AAXA;AAcA,mBACA;AACAhD;AADA,QADA;AAIA;AACA0C;AACA;AAjOA,GAxBA;AA6PAO,SA7PA,qBA6PA;AACA;AACA;AACA;AAEA;AAlQA","names":["data","value1","value2","radio","sshList","tempList","swhList","waveList","mylayer","radios","select1","select2","listDic","middle_names","maps","wmsLayers","addedLayer","components","OceanMap","methods","getLocalTime","nS","fileSubmit","confirmButtonText","callback","fullscreen","lock","text","spinner","background","then","loadOption","initMap","id","title","source","url","target","layers","tdtLayer","view","projection","center","zoom","controls","units","className","coordinateFormat","undefinedHTML","showInfo","_this","document","su","heng","coor","e","bbox","viewResolution","getSource","getFeatureInfoUrl","INFO_FORMAT","VERSION","FORMAT","fetch","result","getMiddle","arr","select","flags","draw","alert","isEmpty","list","console","getRadio","init","titleName","map","index","params","LAYERS","TILED","serverType","transition","mounted"],"sourceRoot":"views","sources":["Ocean.vue"],"sourcesContent":["<template>\r\n<div style=\"width:100%;height:100%;background-color: #F3F2F3;\">\r\n     <div class=\"box\">\r\n        <div id=\"dashboard\">\r\n            <div id=\"data_upload\" class=\"part\">\r\n                <div class=\"title\">\r\n                    <h4>\r\n                       数据上传\r\n                    </h4>\r\n                </div>\r\n                <div class=\"center\">\r\n                    <input type=\"button\" value=\"上传海洋数据\" id=\"data_btn\" @click=\"fileSubmit\">\r\n                </div>\r\n            </div>\r\n            <div class=\"part\">\r\n                <div class=\"title\" >\r\n                    <h4>\r\n                        选择日期\r\n                    </h4>   \r\n                    <div class=\"container\">\r\n                        <el-date-picker\r\n                            v-model=\"value1\"\r\n                            type=\"date\"\r\n                            placeholder=\"选择日期\"\r\n                            format=\"yyyy-MM-dd\"\r\n                            value-format=\"yyyy-MM-dd\">\r\n                        </el-date-picker>\r\n                        <el-time-select\r\n                            v-model=\"value2\"\r\n                            :picker-options=\"{\r\n                                start: '00:00',\r\n                                step: '01:00',\r\n                                end: '23:00'\r\n                            }\"\r\n                            placeholder=\"选择时间\">\r\n                        </el-time-select>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            \r\n            <!-- <hr class=\"split\"> -->\r\n            <el-divider></el-divider>\r\n            <div style=\"margin-bottom: 5%;\" class=\"part\">  <!--海洋-->\r\n                <div class=\"title\">\r\n                    <h4>\r\n                        选择海洋要素数值\r\n                    </h4>\r\n                </div>\r\n               \r\n                <div style=\"margin-left:5%;\">\r\n                     <el-radio-group class=\"group\" clearable=true v-model=\"radio\" @change=\"getRadio\">\r\n                    <div class=\"type\">\r\n                        <el-radio :label='\"ssh\"'>ssh</el-radio>\r\n                        <div class=\"choose\">\r\n                            <table>\r\n                                <el-checkbox-group v-model=\"sshList\">\r\n                                <tr>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v1\">Real</el-checkbox>\r\n                                  </td>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v2\">Pred</el-checkbox>\r\n                                  </td>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v3\">Corr</el-checkbox>\r\n                                  </td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td colspan=\"2\">\r\n                                        <el-checkbox label=\"v4\">Error_Before</el-checkbox>\r\n                                    </td>\r\n                                    <td  style=\"width: 40%;\">\r\n                                        <el-checkbox label=\"v5\">Error_After</el-checkbox>\r\n                                    </td>\r\n                                </tr>\r\n                                </el-checkbox-group>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"type\">\r\n                        <el-radio :label='\"temperature\"'>temperature</el-radio>\r\n                        <div class=\"choose\">\r\n                            <table>\r\n                                <el-checkbox-group v-model=\"tempList\">\r\n                                <tr>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v1\">Real</el-checkbox>\r\n                                  </td>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v2\">Pred</el-checkbox>\r\n                                  </td>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v3\">Corr</el-checkbox>\r\n                                  </td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td colspan=\"2\">\r\n                                        <el-checkbox label=\"v4\">Error_Before</el-checkbox>\r\n                                    </td>\r\n                                    <td  style=\"width: 40%;\">\r\n                                        <el-checkbox label=\"v5\">Error_After</el-checkbox>\r\n                                    </td>\r\n                                </tr>\r\n                                </el-checkbox-group>\r\n                            </table>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"type\">\r\n                        <el-radio :label='\"swh\"'>swh</el-radio>\r\n                          <div class=\"choose\">\r\n                            <table>\r\n                                <el-checkbox-group v-model=\"swhList\">\r\n                                <tr>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v1\">Real</el-checkbox>\r\n                                  </td>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v2\">Pred</el-checkbox>\r\n                                  </td>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v3\">Corr</el-checkbox>\r\n                                  </td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td colspan=\"2\">\r\n                                        <el-checkbox label=\"v4\">Error_Before</el-checkbox>\r\n                                    </td>\r\n                                    <td  style=\"width: 40%;\">\r\n                                        <el-checkbox label=\"v5\">Error_After</el-checkbox>\r\n                                    </td>\r\n                                </tr>\r\n                                 </el-checkbox-group>\r\n                            </table>\r\n                        </div>       \r\n                    </div>\r\n                    <div class=\"type\">\r\n                        <el-radio :label='\"wave_direction\"'>wave_direction</el-radio>\r\n                          <div class=\"choose\">\r\n                            <table>\r\n                                 <el-checkbox-group v-model=\"waveList\">\r\n                                <tr>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v1\">Fore</el-checkbox>\r\n                                  </td>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v2\">Pred</el-checkbox>\r\n                                  </td>\r\n                                  <td>\r\n                                    <el-checkbox label=\"v3\">Re</el-checkbox>\r\n                                  </td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td colspan=\"2\">\r\n                                        <el-checkbox label=\"v4\">Re-fore</el-checkbox>\r\n                                    </td>\r\n                                    <td  style=\"width: 40%;\">\r\n                                        <el-checkbox label=\"v5\">Re-pred</el-checkbox>\r\n                                    </td>\r\n                                </tr>\r\n                                </el-checkbox-group>\r\n                            </table>\r\n                        </div>       \r\n                    </div>\r\n                    </el-radio-group>\r\n                </div>\r\n            </div>\r\n           \r\n            <div style=\"margin-top: 8%;\">\r\n                <div class=\"center\">\r\n                    <input type=\"button\" value=\"渲染\" id=\"draw_btn\" @click=\"draw\">\r\n                </div>\r\n            </div>\r\n           \r\n        </div>\r\n        <div class=\"vis-content\">   <!--可视化区域-->\r\n            <div class=\"vis\">\r\n               <OceanMap ref=\"map1\"/>\r\n                 <!-- <iframe name=\"map1\" src=\"/map\" width=\"100%\" height=\"100%\" frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" allowtransparency=\"yes\"></iframe> -->\r\n            </div>\r\n            <div class=\"vis\">\r\n                <OceanMap ref=\"map2\"/>\r\n            </div>\r\n            <div class=\"vis\">\r\n                 <OceanMap ref=\"map3\"/>\r\n            </div>\r\n            <div class=\"vis\">\r\n                 <OceanMap ref=\"map4\"/>\r\n            </div>\r\n            <div class=\"vis\">\r\n                 <OceanMap ref=\"map5\"/>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n    \r\n</template>\r\n\r\n<script>\r\nimport OceanMap from \"../src/components/Map\";\r\nimport \"ol/ol.css\";\r\nimport Map from \"ol/Map\";\r\nimport View from \"ol/View\";\r\nimport TileLayer from \"ol/layer/Tile\";\r\nimport XYZ from \"ol/source/XYZ\";\r\nimport ScaleLine from \"ol/control/ScaleLine\";\r\nimport MousePosition from \"ol/control/MousePosition\"\r\nimport { fromLonLat } from \"ol/proj\";\r\nimport {Loading} from \"element-ui\"\r\nimport 'ol/ol.css';\r\nimport ImageWMS from 'ol/source/ImageWMS';\r\nimport OSM from 'ol/source/OSM';\r\n//import {Image as ImageLayer, Tile as TileLayer} from 'ol/layer';\r\n\r\nimport TileWMS from \"ol/source/TileWMS\";\r\n\r\n// import Control from 'ol/control';\r\n// import {Control, defaults as defaultControls} from 'ol/control';\r\nimport {OverviewMap, defaults as defaultControls } from \"ol/control\";\r\nimport {format} from \"ol/coordinate\";\r\n  export default {\r\n    data() {\r\n      return {\r\n        value1:'',   //日期\r\n        value2:'',   //时刻\r\n        radio: \"\",  //选择的属性\r\n        sshList: [],\r\n        tempList: [],\r\n        swhList: [],\r\n        waveList: [],\r\n        mylayer:``,\r\n        radios:['ssh','temperature','swh','wave_direction'],\r\n        select1:[\"Real\",\"pred\",\"Corr\",\"Error_Before\",\"Error_After\"],\r\n        select2:[\"Fore\",\"pred\",\"Re\",\"Re-fore\",\"Re-pred\"],\r\n        listDic:['v1','v2','v3','v4','v5'],\r\n        middle_names : [],\r\n        maps:[],\r\n        wmsLayers:[],\r\n        addedLayer:[],\r\n      };\r\n    },\r\n components: {\r\n        OceanMap,\r\n    },\r\n     methods: {\r\n        \r\n        getLocalTime(nS) {\r\n            return new Date(parseInt(nS) * 1000).toLocaleString().replace(/:\\d{1,2}$/, ' ');\r\n        },\r\n      fileSubmit() {\r\n        this.$MessageBox.alert('请将nc文件放置到home/user_ocean_data,然后点击确定', '提示', {\r\n          confirmButtonText: '确定',\r\n          callback: action => {\r\n           if(action=== 'confirm'){\r\n                const loadOption=Loading.service({\r\n                    fullscreen: true ,\r\n                    lock: true, \r\n                    text: '正在处理中', \r\n                    spinner: 'el-icon-loading',\r\n                     background: 'rgba(0, 0, 0, 0.7)'});\r\n                this.$http.get(\"api/ocean/processOceanData\")\r\n                .then(function(response){\r\n                    // console.log(response)\r\n                   let state=response.data.success;\r\n                    if(state===true){\r\n                        loadOption.close()\r\n                    }\r\n                })\r\n            \r\n            }\r\n          }\r\n        });\r\n      },\r\n\r\n      initMap(id){\r\n        //   console.log(\"hello\")\r\n          var tdtLayer = new TileLayer({\r\n          title: \"谷歌矢量地图服务\",\r\n          source: new XYZ({\r\n            // arcgis server\r\n            url: 'http://map.geoq.cn/arcgis/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}'\r\n          })\r\n        });\r\n        let map = new Map({\r\n        target: document.getElementsByClassName('map')[id],                          // 关联到对应的div容器\r\n        layers: [\r\n          tdtLayer\r\n        ],\r\n        view: new View({                     // 地图视图\r\n          projection: 'EPSG:4326',\r\n          center: [113, 12],\r\n          zoom: 4\r\n        }),\r\n        controls:  defaultControls().extend([\r\n          new ScaleLine({\r\n            //设置度量单位为米\r\n            units: 'metric',\r\n            target: 'scalebar',\r\n            className: 'ol-scale-line1'\r\n          }), \r\n          new MousePosition({\r\n            coordinateFormat: function (coordinate) {\r\n              return format(coordinate, '经度:{x} 纬度:{y}', 2);\r\n            },\r\n            projection: 'EPSG:4326',\r\n            className: 'custom-mouse-position',\r\n            target: document.getElementsByClassName('lnglat')[id],\r\n            undefinedHTML: '&nbsp;'\r\n          })\r\n        ])\r\n      })\r\n      this.maps.push(map);\r\n      this.showInfo(id);\r\n      },\r\n\r\n      showInfo(id){\r\n      let _this=this;\r\n      _this.maps[id].on(\"moveend\", function (e) {\r\n      let value=\"Scale 1 : \"+document.getElementsByClassName(\"ol-scale-line1-inner\")[id].innerHTML;\r\n       document.getElementsByClassName(\"scale\")[id].innerHTML=value;\r\n      let extent = _this.maps[id].getView().calculateExtent()\r\n      let geLng = (extent[2] - extent[0]) / 5\r\n      let geLat = (extent[3] - extent[1]) / 5\r\n      let su = ``, heng = ``;\r\n      for (let i = 0; i < 5; i++) {\r\n        su += `<div class=\"kedu1\"><span>${(geLat * i + extent[1]).toFixed(1)}</span></div>`\r\n        heng += `<div class=\"kedu2\"><span>${(geLng * i + extent[0]).toFixed(1)}</span></div>`\r\n      }\r\n      document.getElementsByClassName(\"left\")[id].innerHTML=su;\r\n      // $(\"#mapPanel1 .left\").html(su);\r\n      document.getElementsByClassName(\"top1\")[id].innerHTML=heng;\r\n      // $(\".top1\").html(heng)\r\n    })\r\n    \r\n    this.maps[id].on('singleclick', async(e)=> {\r\n      let coor = e.coordinate;\r\n      let bbox = (coor[0] - 2) + \",\" + (coor[1] - 2) + \",\" + (coor[0] + 2) + \",\" + (coor[1] + 2)\r\n      let viewResolution = _this.maps[id].getView().getResolution();\r\n      let url = _this.wmsLayers[id]\r\n          .getSource()\r\n          .getFeatureInfoUrl(coor, viewResolution, \"EPSG:4326\", {\r\n            INFO_FORMAT: \"application/json\", //输出为json字符串\r\n            VERSION:'1.1.1',\r\n            FORMAT: 'image/png'\r\n          });\r\n    if (url) {\r\n          let data = await fetch(url).then(function (res) {\r\n            return res.text(); //返回Promise\r\n          });\r\n          data=JSON.parse(data)\r\n          let result=data.features[0].properties.GRAY_INDEX.toFixed(4)\r\n          document.getElementsByClassName(\"mapval\")[id].innerHTML=result;\r\n        }\r\n    });\r\n        },\r\n     getMiddle(arr,select){\r\n         let flags=[false,false,false,false,false]\r\n         for(let i=0;i<arr.length;i++){\r\n                    let index=this.listDic.indexOf(arr[i]);\r\n                    flags[index]=true;\r\n                    this.middle_names.push(select[index]);\r\n                }\r\n        for(let i=0;i<flags.length;i++){\r\n            if(!flags[i]){\r\n                this.middle_names.push(select[i])\r\n            }\r\n        }\r\n     },\r\n      \r\n      draw(){\r\n          this.middle_names=[]\r\n          if(this.value1===''||this.value2===''){\r\n              alert(\"请选择日期，时间\");\r\n              return;\r\n          }else if(this.radio===''){\r\n              alert(\"请勾选海洋要素数值！\")\r\n          }else{\r\n              let type=this.radio;\r\n              let isEmpty=false;\r\n              let list=null;\r\n              if(type=='ssh'){\r\n                  if(this.sshList.length===0){\r\n                      isEmpty=true;\r\n                  }else{\r\n                      list=this.sshList;\r\n                      this.getMiddle(list,this.select1);\r\n                      \r\n                  }\r\n             }else if(type=='temperature'){\r\n                  if(this.tempList.length===0){\r\n                      isEmpty=true;\r\n                  }else{\r\n                      list=this.tempList;\r\n                       this.getMiddle(list,this.select1);\r\n                  }\r\n             }else if(type=='swh'){\r\n                  if(this.swhList.length===0){\r\n                      isEmpty=true;\r\n                  }else{\r\n                      list=this.swhList;\r\n                     this.getMiddle(list,this.select1);\r\n                  }\r\n             }else if(type=='wave_direction'){\r\n                 if(this.waveList.length===0){\r\n                      isEmpty=true;\r\n                  }else{\r\n                      list=this.waveList;\r\n                     this.getMiddle(list,this.select2);\r\n                  }\r\n             }\r\n             console.log(this.middle_names)\r\n             if(isEmpty){\r\n                 alert(\"请勾选有单选框的复选框选项\");\r\n                 return;\r\n             }else{\r\n                 let riqi=this.value1+\" \"+this.value2;\r\n                 let shijianchuo=(new Date(riqi)).getTime(); //时间戳\r\n                 for (let i = 0; i < this.wmsLayers.length; i++) { //清空所有图层\r\n                        this.maps[i] && this.maps[i].removeLayer(this.wmsLayers[i])\r\n                    }\r\n                    this.wmsLayers = [];\r\n                    for (let i = 0; i < 5; i++) {\r\n                        let map = this.maps[i];\r\n                        let middle_name = this.middle_names[i]\r\n                        let first_name = this.radio.toUpperCase()\r\n                        let name = first_name + \"_\" + middle_name + \"_\" + shijianchuo\r\n                       \r\n                        this.mylayer = 'tif2022:' + name\r\n                        // console.log('433'+name)\r\n                        // console.log(this.$refs.map1.innerHTML)\r\n                        document.getElementsByClassName(\"maptitle\")[i].innerHTML = first_name + \"_\" + middle_name;\r\n                        this.init(name,map,i)\r\n                    }\r\n                }\r\n             }\r\n      },\r\n     \r\n\r\n     getRadio(){\r\n        this.sshList=[]\r\n        this.tempList=[]\r\n        this.swhList=[]\r\n        this.waveList=[]\r\n     },\r\n    //  渲染图层\r\n    init(titleName,map,index) {\r\n     \r\n        this.addedLayer = mylayer; //层的名字\r\n       \r\n        let tileWMS=new TileWMS({\r\n                url: \"vector/geoserver/tif2022/wms\",\r\n                // Layers需要指定要显示的图层名\r\n                params: { \r\n                    LAYERS: this.mylayer, \r\n                    TILED: true, \r\n                    VERSION:'1.1.1',\r\n                    FORMAT: 'image/png'},\r\n           \t    // serverType明显为geoserver\r\n                serverType: \"geoserver\",\r\n                // Countries have transparency, so do not fade tiles:\r\n                transition: 0\r\n            });\r\n       \r\n        var layers = \r\n            new TileLayer({\r\n                source: tileWMS\r\n            });\r\n        this.wmsLayers.push(layers)\r\n        map.addLayer(layers)\r\n        }\r\n\r\n    \r\n    },\r\n     mounted(){\r\n        for(let i=0;i<5;i++){\r\n            this.initMap(i);\r\n        }\r\n        \r\n     }\r\n  }\r\n</script>\r\n\r\n<style>\r\nbody,html{\r\n    height:100%;\r\n    background-color: #F3F2F3;\r\n    margin: 0;\r\n    /* text-align: center; */\r\n}\r\n\r\n.box{\r\n    /* display: inline-block; */\r\n    width: 94%;\r\n    height: 100%;\r\n    margin: 0 auto;\r\n}\r\n\r\n.box .title{\r\n    margin-left: 3%;\r\n}\r\n\r\n.box .container{\r\n    width: 100%;\r\n    text-align: center;\r\n    margin-left: -2%;\r\n\r\n}\r\n\r\n#dashboard{\r\n    float: left;\r\n    height: calc(100% - 10px);\r\n    width: 30%;\r\n    /* border: 1px solid #D2D2D2; */\r\n    margin-top: 10px;\r\n    background-color: white;\r\n}\r\n\r\n.box .vis-content{\r\n    float: left;\r\n    height: calc(100% - 10px);\r\n    width: 70%;\r\n    margin-top:10px;\r\n    background-color: white;\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n}\r\n\r\n.box .vis-content .vis{\r\n    width: 33%;\r\n    height: 50%;\r\n}\r\n\r\n#dashboard #sub_btn{\r\n    width: 131px;\r\n    height: 33px;\r\n    color: white;\r\n    cursor: pointer;\r\n    background: #4472C4;\r\n    border: none;\r\n    outline: none;\r\n    font-size: 14px;\r\n    border-radius: 5px;\r\n}\r\n\r\n#dashboard .squ-checkbox{\r\n    margin-right:3%;\r\n}\r\n#dashboard .type{\r\n    display: block;\r\n    width: 100%;\r\n}\r\n.el-radio-group{\r\n    width: 100%;\r\n}\r\n\r\n#dashboard .choose{\r\n    padding-left: 8%;\r\n    margin-bottom: 5%;\r\n    margin-top:1% ;\r\n}\r\n\r\n#dashboard .choose table{\r\n    width: 84%;\r\n    border: 0;\r\n}\r\n#dashboard .choose table tr{\r\n    width: 100%;\r\n}\r\n#dashboard .choose table td{\r\n    height: 25px;\r\n    width: 37%;\r\n    margin-left:5px;\r\n    /* display: inline-block; */\r\n}\r\n\r\n#dashboard .center{\r\n    /* margin-left: -15%; */\r\n    margin-top: 3%;\r\n    text-align:center\r\n}\r\n\r\n#dashboard #draw_btn,#dashboard #data_btn{\r\n    width: 80%;\r\n    height: 33px;\r\n    color: white;\r\n    cursor: pointer;\r\n    background: #4472C4;\r\n    border: none;\r\n    outline: none;\r\n    font-size: 14px;\r\n    border-radius: 5px;\r\n}\r\n#dashboard .split{\r\n    width: 90%;\r\n    margin: 0 auto;\r\n    /* border-color: #EEEEEE; */\r\n    background-color: #EEEEEE;\r\n    height: 0.1px;\r\n}\r\n\r\n.container #date{\r\n    float: left;\r\n    margin-left: 2%;\r\n    height: 30px;\r\n    line-height: 30px;\r\n    margin-right: 1%;\r\n}\r\n\r\n.container .form-horizontal{\r\n    float: left;\r\n}\r\n\r\n.el-input__inner {\r\n    height: 33px;\r\n    line-height: 33px;  \r\n}\r\n.el-input__icon {\r\n    line-height: 33px;\r\n}\r\n.el-date-editor.el-input{\r\n    width: 180px;\r\n    margin: 0 3px;\r\n}\r\n\r\n.el-radio {\r\n    font-weight: 700;\r\n}\r\n\r\n.el-radio__label,.el-checkbox__label {\r\n    font-size: 15px;\r\n}\r\n\r\n.el-divider--horizontal{\r\n    width: 90%;\r\n    margin: 24px auto\r\n}\r\n\r\ntitle1{\r\n    left:200px;\r\n    bottom: 200px;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}