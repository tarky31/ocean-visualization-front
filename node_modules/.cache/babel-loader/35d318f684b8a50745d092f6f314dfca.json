{"ast":null,"code":"import \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport { getCurrentInstance, ref, watchEffect, computed, unref, h } from 'vue';\nimport '../../../../utils/index.mjs';\nimport '../../../../hooks/index.mjs';\nimport { cellForced, getDefaultClassName, defaultRenderCell, treeCellPrefix } from '../config.mjs';\nimport { parseWidth, parseMinWidth } from '../util.mjs';\nimport { useNamespace } from '../../../../hooks/use-namespace/index.mjs';\nimport { debugWarn } from '../../../../utils/error.mjs';\n\nfunction useRender(props, slots, owner) {\n  var instance = getCurrentInstance();\n  var columnId = ref(\"\");\n  var isSubColumn = ref(false);\n  var realAlign = ref();\n  var realHeaderAlign = ref();\n  var ns = useNamespace(\"table\");\n  watchEffect(function () {\n    realAlign.value = props.align ? \"is-\".concat(props.align) : null;\n    realAlign.value;\n  });\n  watchEffect(function () {\n    realHeaderAlign.value = props.headerAlign ? \"is-\".concat(props.headerAlign) : realAlign.value;\n    realHeaderAlign.value;\n  });\n  var columnOrTableParent = computed(function () {\n    var parent = instance.vnode.vParent || instance.parent;\n\n    while (parent && !parent.tableId && !parent.columnId) {\n      parent = parent.vnode.vParent || parent.parent;\n    }\n\n    return parent;\n  });\n  var realWidth = ref(parseWidth(props.width));\n  var realMinWidth = ref(parseMinWidth(props.minWidth));\n\n  var setColumnWidth = function setColumnWidth(column) {\n    if (realWidth.value) column.width = realWidth.value;\n\n    if (realMinWidth.value) {\n      column.minWidth = realMinWidth.value;\n    }\n\n    if (!column.minWidth) {\n      column.minWidth = 80;\n    }\n\n    column.realWidth = Number(column.width === void 0 ? column.minWidth : column.width);\n    return column;\n  };\n\n  var setColumnForcedProps = function setColumnForcedProps(column) {\n    var type = column.type;\n    var source = cellForced[type] || {};\n    Object.keys(source).forEach(function (prop) {\n      var value = source[prop];\n\n      if (prop !== \"className\" && value !== void 0) {\n        column[prop] = value;\n      }\n    });\n    var className = getDefaultClassName(type);\n\n    if (className) {\n      var forceClass = \"\".concat(unref(ns.namespace), \"-\").concat(className);\n      column.className = column.className ? \"\".concat(column.className, \" \").concat(forceClass) : forceClass;\n    }\n\n    return column;\n  };\n\n  var checkSubColumn = function checkSubColumn(children) {\n    if (children instanceof Array) {\n      children.forEach(function (child) {\n        return check(child);\n      });\n    } else {\n      check(children);\n    }\n\n    function check(item) {\n      var _a;\n\n      if (((_a = item == null ? void 0 : item.type) == null ? void 0 : _a.name) === \"ElTableColumn\") {\n        item.vParent = instance;\n      }\n    }\n  };\n\n  var setColumnRenders = function setColumnRenders(column) {\n    if (props.renderHeader) {\n      debugWarn(\"TableColumn\", \"Comparing to render-header, scoped-slot header is easier to use. We recommend users to use scoped-slot header.\");\n    } else if (column.type !== \"selection\") {\n      column.renderHeader = function (scope) {\n        instance.columnConfig.value[\"label\"];\n        var renderHeader = slots.header;\n        return renderHeader ? renderHeader(scope) : column.label;\n      };\n    }\n\n    var originRenderCell = column.renderCell;\n\n    if (column.type === \"expand\") {\n      column.renderCell = function (data) {\n        return h(\"div\", {\n          class: \"cell\"\n        }, [originRenderCell(data)]);\n      };\n\n      owner.value.renderExpanded = function (data) {\n        return slots.default ? slots.default(data) : slots.default;\n      };\n    } else {\n      originRenderCell = originRenderCell || defaultRenderCell;\n\n      column.renderCell = function (data) {\n        var children = null;\n\n        if (slots.default) {\n          children = slots.default(data);\n        } else {\n          children = originRenderCell(data);\n        }\n\n        var prefix = treeCellPrefix(data);\n        var props2 = {\n          class: \"cell\",\n          style: {}\n        };\n\n        if (column.showOverflowTooltip) {\n          props2.class = \"\".concat(props2.class, \" \").concat(unref(ns.namespace), \"-tooltip\");\n          props2.style = {\n            width: \"\".concat((data.column.realWidth || Number(data.column.width)) - 1, \"px\")\n          };\n        }\n\n        checkSubColumn(children);\n        return h(\"div\", props2, [prefix, children]);\n      };\n    }\n\n    return column;\n  };\n\n  var getPropsData = function getPropsData() {\n    for (var _len = arguments.length, propsKey = new Array(_len), _key = 0; _key < _len; _key++) {\n      propsKey[_key] = arguments[_key];\n    }\n\n    return propsKey.reduce(function (prev, cur) {\n      if (Array.isArray(cur)) {\n        cur.forEach(function (key) {\n          prev[key] = props[key];\n        });\n      }\n\n      return prev;\n    }, {});\n  };\n\n  var getColumnElIndex = function getColumnElIndex(children, child) {\n    return [].indexOf.call(children, child);\n  };\n\n  return {\n    columnId: columnId,\n    realAlign: realAlign,\n    isSubColumn: isSubColumn,\n    realHeaderAlign: realHeaderAlign,\n    columnOrTableParent: columnOrTableParent,\n    setColumnWidth: setColumnWidth,\n    setColumnForcedProps: setColumnForcedProps,\n    setColumnRenders: setColumnRenders,\n    getPropsData: getPropsData,\n    getColumnElIndex: getColumnElIndex\n  };\n}\n\nexport { useRender as default };","map":{"version":3,"mappings":";;;;;;;;;;;;;;AAUA,SAASA,SAAT,CAAmBC,KAAnB,EAA0BC,KAA1B,EAAiCC,KAAjC,EAAwC;AACtC,MAAMC,QAAQ,GAAGC,kBAAkB,EAAnC;AACA,MAAMC,QAAQ,GAAGC,GAAG,CAAC,EAAD,CAApB;AACA,MAAMC,WAAW,GAAGD,GAAG,CAAC,KAAD,CAAvB;AACA,MAAME,SAAS,GAAGF,GAAG,EAArB;AACA,MAAMG,eAAe,GAAGH,GAAG,EAA3B;AACA,MAAMI,EAAE,GAAGC,YAAY,CAAC,OAAD,CAAvB;AACAC,aAAW,CAAC,YAAM;AAChBJ,aAAS,CAACK,KAAV,GAAkBb,KAAK,CAACc,KAAN,gBAAoBd,KAAK,CAACc,KAA1B,IAAoC,IAAtD;AACAN,aAAS,CAACK,KAAV;AACD,GAHU,CAAX;AAIAD,aAAW,CAAC,YAAM;AAChBH,mBAAe,CAACI,KAAhB,GAAwBb,KAAK,CAACe,WAAN,gBAA0Bf,KAAK,CAACe,WAAhC,IAAgDP,SAAS,CAACK,KAAlF;AACAJ,mBAAe,CAACI,KAAhB;AACD,GAHU,CAAX;AAIA,MAAMG,mBAAmB,GAAGC,QAAQ,CAAC,YAAM;AACzC,QAAIC,MAAM,GAAGf,QAAQ,CAACgB,KAAT,CAAeC,OAAf,IAA0BjB,QAAQ,CAACe,MAAhD;;AACA,WAAOA,MAAM,IAAI,CAACA,MAAM,CAACG,OAAlB,IAA6B,CAACH,MAAM,CAACb,QAA5C,EAAsD;AACpDa,YAAM,GAAGA,MAAM,CAACC,KAAP,CAAaC,OAAb,IAAwBF,MAAM,CAACA,MAAxC;AACD;;AACD,WAAOA,MAAP;AACD,GANmC,CAApC;AAOA,MAAMI,SAAS,GAAGhB,GAAG,CAACiB,UAAU,CAACvB,KAAK,CAACwB,KAAP,CAAX,CAArB;AACA,MAAMC,YAAY,GAAGnB,GAAG,CAACoB,aAAa,CAAC1B,KAAK,CAAC2B,QAAP,CAAd,CAAxB;;AACA,MAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAACC,MAAD,EAAY;AACjC,QAAIP,SAAS,CAACT,KAAd,EACEgB,MAAM,CAACL,KAAP,GAAeF,SAAS,CAACT,KAAzB;;AACF,QAAIY,YAAY,CAACZ,KAAjB,EAAwB;AACtBgB,YAAM,CAACF,QAAP,GAAkBF,YAAY,CAACZ,KAA/B;AACD;;AACD,QAAI,CAACgB,MAAM,CAACF,QAAZ,EAAsB;AACpBE,YAAM,CAACF,QAAP,GAAkB,EAAlB;AACD;;AACDE,UAAM,CAACP,SAAP,GAAmBQ,MAAM,CAACD,MAAM,CAACL,KAAP,KAAiB,KAAK,CAAtB,GAA0BK,MAAM,CAACF,QAAjC,GAA4CE,MAAM,CAACL,KAApD,CAAzB;AACA,WAAOK,MAAP;AACD,GAXD;;AAYA,MAAME,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACF,MAAD,EAAY;AACvC,QAAMG,IAAI,GAAGH,MAAM,CAACG,IAApB;AACA,QAAMC,MAAM,GAAGC,UAAU,CAACF,IAAD,CAAV,IAAoB,EAAnC;AACAG,UAAM,CAACC,IAAP,CAAYH,MAAZ,EAAoBI,OAApB,CAA4B,UAACC,IAAD,EAAU;AACpC,UAAMzB,KAAK,GAAGoB,MAAM,CAACK,IAAD,CAApB;;AACA,UAAIA,IAAI,KAAK,WAAT,IAAwBzB,KAAK,KAAK,KAAK,CAA3C,EAA8C;AAC5CgB,cAAM,CAACS,IAAD,CAAN,GAAezB,KAAf;AACD;AACF,KALD;AAMA,QAAM0B,SAAS,GAAGC,mBAAmB,CAACR,IAAD,CAArC;;AACA,QAAIO,SAAJ,EAAe;AACb,UAAME,UAAU,aAAMC,KAAK,CAAChC,EAAE,CAACiC,SAAJ,CAAX,cAA6BJ,SAA7B,CAAhB;AACAV,YAAM,CAACU,SAAP,GAAmBV,MAAM,CAACU,SAAP,aAAsBV,MAAM,CAACU,SAA7B,cAA0CE,UAA1C,IAAyDA,UAA5E;AACD;;AACD,WAAOZ,MAAP;AACD,GAfD;;AAgBA,MAAMe,cAAc,GAAG,SAAjBA,cAAiB,CAACC,QAAD,EAAc;AACnC,QAAIA,QAAQ,YAAYC,KAAxB,EAA+B;AAC7BD,cAAQ,CAACR,OAAT,CAAiB,UAACU,KAAD;AAAA,eAAWC,KAAK,CAACD,KAAD,CAAhB;AAAA,OAAjB;AACD,KAFD,MAEO;AACLC,WAAK,CAACH,QAAD,CAAL;AACD;;AACD,aAASG,KAAT,CAAeC,IAAf,EAAqB;AACnB,UAAIC,EAAJ;;AACA,UAAI,CAAC,CAACA,EAAE,GAAGD,IAAI,IAAI,IAAR,GAAe,KAAK,CAApB,GAAwBA,IAAI,CAACjB,IAAnC,KAA4C,IAA5C,GAAmD,KAAK,CAAxD,GAA4DkB,EAAE,CAACC,IAAhE,MAA0E,eAA9E,EAA+F;AAC7FF,YAAI,CAAC7B,OAAL,GAAejB,QAAf;AACD;AACF;AACF,GAZD;;AAaA,MAAMiD,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACvB,MAAD,EAAY;AACnC,QAAI7B,KAAK,CAACqD,YAAV,EAAwB;AACtBC,eAAS,CAAC,aAAD,EAAgB,gHAAhB,CAAT;AACD,KAFD,MAEO,IAAIzB,MAAM,CAACG,IAAP,KAAgB,WAApB,EAAiC;AACtCH,YAAM,CAACwB,YAAP,GAAsB,UAACE,KAAD,EAAW;AAC/BpD,gBAAQ,CAACqD,YAAT,CAAsB3C,KAAtB,CAA4B,OAA5B;AACA,YAAMwC,YAAY,GAAGpD,KAAK,CAACwD,MAA3B;AACA,eAAOJ,YAAY,GAAGA,YAAY,CAACE,KAAD,CAAf,GAAyB1B,MAAM,CAAC6B,KAAnD;AACD,OAJD;AAKD;;AACD,QAAIC,gBAAgB,GAAG9B,MAAM,CAAC+B,UAA9B;;AACA,QAAI/B,MAAM,CAACG,IAAP,KAAgB,QAApB,EAA8B;AAC5BH,YAAM,CAAC+B,UAAP,GAAoB,UAACC,IAAD;AAAA,eAAUC,CAAC,CAAC,KAAD,EAAQ;AACrCC,eAAK,EAAE;AAD8B,SAAR,EAE5B,CAACJ,gBAAgB,CAACE,IAAD,CAAjB,CAF4B,CAAX;AAAA,OAApB;;AAGA3D,WAAK,CAACW,KAAN,CAAYmD,cAAZ,GAA6B,UAACH,IAAD,EAAU;AACrC,eAAO5D,KAAK,CAACgE,OAAN,GAAgBhE,KAAK,CAACgE,OAAN,CAAcJ,IAAd,CAAhB,GAAsC5D,KAAK,CAACgE,OAAnD;AACD,OAFD;AAGD,KAPD,MAOO;AACLN,sBAAgB,GAAGA,gBAAgB,IAAIO,iBAAvC;;AACArC,YAAM,CAAC+B,UAAP,GAAoB,UAACC,IAAD,EAAU;AAC5B,YAAIhB,QAAQ,GAAG,IAAf;;AACA,YAAI5C,KAAK,CAACgE,OAAV,EAAmB;AACjBpB,kBAAQ,GAAG5C,KAAK,CAACgE,OAAN,CAAcJ,IAAd,CAAX;AACD,SAFD,MAEO;AACLhB,kBAAQ,GAAGc,gBAAgB,CAACE,IAAD,CAA3B;AACD;;AACD,YAAMM,MAAM,GAAGC,cAAc,CAACP,IAAD,CAA7B;AACA,YAAMQ,MAAM,GAAG;AACbN,eAAK,EAAE,MADM;AAEbO,eAAK,EAAE;AAFM,SAAf;;AAIA,YAAIzC,MAAM,CAAC0C,mBAAX,EAAgC;AAC9BF,gBAAM,CAACN,KAAP,aAAkBM,MAAM,CAACN,KAAzB,cAAkCrB,KAAK,CAAChC,EAAE,CAACiC,SAAJ,CAAvC;AACA0B,gBAAM,CAACC,KAAP,GAAe;AACb9C,iBAAK,YAAK,CAACqC,IAAI,CAAChC,MAAL,CAAYP,SAAZ,IAAyBQ,MAAM,CAAC+B,IAAI,CAAChC,MAAL,CAAYL,KAAb,CAAhC,IAAuD,CAA5D;AADQ,WAAf;AAGD;;AACDoB,sBAAc,CAACC,QAAD,CAAd;AACA,eAAOiB,CAAC,CAAC,KAAD,EAAQO,MAAR,EAAgB,CAACF,MAAD,EAAStB,QAAT,CAAhB,CAAR;AACD,OApBD;AAqBD;;AACD,WAAOhB,MAAP;AACD,GA3CD;;AA4CA,MAAM2C,YAAY,GAAG,SAAfA,YAAe,GAAiB;AAAA,sCAAbC,QAAa;AAAbA,cAAa;AAAA;;AACpC,WAAOA,QAAQ,CAACC,MAAT,CAAgB,UAACC,IAAD,EAAOC,GAAP,EAAe;AACpC,UAAI9B,KAAK,CAAC+B,OAAN,CAAcD,GAAd,CAAJ,EAAwB;AACtBA,WAAG,CAACvC,OAAJ,CAAY,UAACyC,GAAD,EAAS;AACnBH,cAAI,CAACG,GAAD,CAAJ,GAAY9E,KAAK,CAAC8E,GAAD,CAAjB;AACD,SAFD;AAGD;;AACD,aAAOH,IAAP;AACD,KAPM,EAOJ,EAPI,CAAP;AAQD,GATD;;AAUA,MAAMI,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAClC,QAAD,EAAWE,KAAX,EAAqB;AAC5C,WAAO,GAAGiC,OAAH,CAAWC,IAAX,CAAgBpC,QAAhB,EAA0BE,KAA1B,CAAP;AACD,GAFD;;AAGA,SAAO;AACL1C,YAAQ,EAARA,QADK;AAELG,aAAS,EAATA,SAFK;AAGLD,eAAW,EAAXA,WAHK;AAILE,mBAAe,EAAfA,eAJK;AAKLO,uBAAmB,EAAnBA,mBALK;AAMLY,kBAAc,EAAdA,cANK;AAOLG,wBAAoB,EAApBA,oBAPK;AAQLqB,oBAAgB,EAAhBA,gBARK;AASLoB,gBAAY,EAAZA,YATK;AAULO,oBAAgB,EAAhBA;AAVK,GAAP;AAYF","names":["useRender","props","slots","owner","instance","getCurrentInstance","columnId","ref","isSubColumn","realAlign","realHeaderAlign","ns","useNamespace","watchEffect","value","align","headerAlign","columnOrTableParent","computed","parent","vnode","vParent","tableId","realWidth","parseWidth","width","realMinWidth","parseMinWidth","minWidth","setColumnWidth","column","Number","setColumnForcedProps","type","source","cellForced","Object","keys","forEach","prop","className","getDefaultClassName","forceClass","unref","namespace","checkSubColumn","children","Array","child","check","item","_a","name","setColumnRenders","renderHeader","debugWarn","scope","columnConfig","header","label","originRenderCell","renderCell","data","h","class","renderExpanded","default","defaultRenderCell","prefix","treeCellPrefix","props2","style","showOverflowTooltip","getPropsData","propsKey","reduce","prev","cur","isArray","key","getColumnElIndex","indexOf","call"],"sources":["../../../../../../../packages/components/table/src/table-column/render-helper.ts"],"sourcesContent":["import { getCurrentInstance, h, ref, computed, watchEffect, unref } from 'vue'\nimport { debugWarn } from '@element-plus/utils'\nimport { useNamespace } from '@element-plus/hooks'\nimport {\n  cellForced,\n  defaultRenderCell,\n  treeCellPrefix,\n  getDefaultClassName,\n} from '../config'\nimport { parseWidth, parseMinWidth } from '../util'\n\nimport type { ComputedRef } from 'vue'\nimport type { TableColumnCtx, TableColumn } from './defaults'\n\nfunction useRender<T>(\n  props: TableColumnCtx<T>,\n  slots,\n  owner: ComputedRef<any>\n) {\n  const instance = getCurrentInstance() as TableColumn<T>\n  const columnId = ref('')\n  const isSubColumn = ref(false)\n  const realAlign = ref<string>()\n  const realHeaderAlign = ref<string>()\n  const ns = useNamespace('table')\n  watchEffect(() => {\n    realAlign.value = props.align ? `is-${props.align}` : null\n    // nextline help render\n    realAlign.value\n  })\n  watchEffect(() => {\n    realHeaderAlign.value = props.headerAlign\n      ? `is-${props.headerAlign}`\n      : realAlign.value\n    // nextline help render\n    realHeaderAlign.value\n  })\n  const columnOrTableParent = computed(() => {\n    let parent: any = instance.vnode.vParent || instance.parent\n    while (parent && !parent.tableId && !parent.columnId) {\n      parent = parent.vnode.vParent || parent.parent\n    }\n    return parent\n  })\n\n  const realWidth = ref(parseWidth(props.width))\n  const realMinWidth = ref(parseMinWidth(props.minWidth))\n  const setColumnWidth = (column: TableColumnCtx<T>) => {\n    if (realWidth.value) column.width = realWidth.value\n    if (realMinWidth.value) {\n      column.minWidth = realMinWidth.value\n    }\n    if (!column.minWidth) {\n      column.minWidth = 80\n    }\n    column.realWidth = Number(\n      column.width === undefined ? column.minWidth : column.width\n    )\n    return column\n  }\n  const setColumnForcedProps = (column: TableColumnCtx<T>) => {\n    // 对于特定类型的 column，某些属性不允许设置\n    const type = column.type\n    const source = cellForced[type] || {}\n    Object.keys(source).forEach((prop) => {\n      const value = source[prop]\n      if (prop !== 'className' && value !== undefined) {\n        column[prop] = value\n      }\n    })\n    const className = getDefaultClassName(type)\n    if (className) {\n      const forceClass = `${unref(ns.namespace)}-${className}`\n      column.className = column.className\n        ? `${column.className} ${forceClass}`\n        : forceClass\n    }\n    return column\n  }\n\n  const checkSubColumn = (children: TableColumn<T> | TableColumn<T>[]) => {\n    if (children instanceof Array) {\n      children.forEach((child) => check(child))\n    } else {\n      check(children)\n    }\n    function check(item: TableColumn<T>) {\n      if (item?.type?.name === 'ElTableColumn') {\n        item.vParent = instance\n      }\n    }\n  }\n  const setColumnRenders = (column: TableColumnCtx<T>) => {\n    // renderHeader 属性不推荐使用。\n    if (props.renderHeader) {\n      debugWarn(\n        'TableColumn',\n        'Comparing to render-header, scoped-slot header is easier to use. We recommend users to use scoped-slot header.'\n      )\n    } else if (column.type !== 'selection') {\n      column.renderHeader = (scope) => {\n        // help render\n        instance.columnConfig.value['label']\n        const renderHeader = slots.header\n        return renderHeader ? renderHeader(scope) : column.label\n      }\n    }\n\n    let originRenderCell = column.renderCell\n    // TODO: 这里的实现调整\n    if (column.type === 'expand') {\n      // 对于展开行，renderCell 不允许配置的。在上一步中已经设置过，这里需要简单封装一下。\n      column.renderCell = (data) =>\n        h(\n          'div',\n          {\n            class: 'cell',\n          },\n          [originRenderCell(data)]\n        )\n      owner.value.renderExpanded = (data) => {\n        return slots.default ? slots.default(data) : slots.default\n      }\n    } else {\n      originRenderCell = originRenderCell || defaultRenderCell\n      // 对 renderCell 进行包装\n      column.renderCell = (data) => {\n        let children = null\n        if (slots.default) {\n          children = slots.default(data)\n        } else {\n          children = originRenderCell(data)\n        }\n        const prefix = treeCellPrefix(data)\n        const props = {\n          class: 'cell',\n          style: {},\n        }\n        if (column.showOverflowTooltip) {\n          props.class = `${props.class} ${unref(ns.namespace)}-tooltip`\n          props.style = {\n            width: `${\n              (data.column.realWidth || Number(data.column.width)) - 1\n            }px`,\n          }\n        }\n        checkSubColumn(children)\n        return h('div', props, [prefix, children])\n      }\n    }\n    return column\n  }\n  const getPropsData = (...propsKey: unknown[]) => {\n    return propsKey.reduce((prev, cur) => {\n      if (Array.isArray(cur)) {\n        cur.forEach((key) => {\n          prev[key] = props[key]\n        })\n      }\n      return prev\n    }, {})\n  }\n  const getColumnElIndex = (children, child) => {\n    return [].indexOf.call(children, child)\n  }\n\n  return {\n    columnId,\n    realAlign,\n    isSubColumn,\n    realHeaderAlign,\n    columnOrTableParent,\n    setColumnWidth,\n    setColumnForcedProps,\n    setColumnRenders,\n    getPropsData,\n    getColumnElIndex,\n  }\n}\n\nexport default useRender\n"]},"metadata":{},"sourceType":"module"}