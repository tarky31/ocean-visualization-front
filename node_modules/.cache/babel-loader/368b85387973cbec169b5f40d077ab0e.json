{"ast":null,"code":"import \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.from.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/es.string.starts-with.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport { defineComponent, inject, ref, openBlock, createElementBlock, normalizeClass, withModifiers, renderSlot } from 'vue';\nimport '../../../hooks/index.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\n\nvar _sfc_main = defineComponent({\n  name: \"ElUploadDrag\",\n  props: {\n    disabled: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: [\"file\"],\n  setup: function setup(props, _ref) {\n    var emit = _ref.emit;\n    var uploader = inject(\"uploader\", {});\n    var ns = useNamespace(\"upload\");\n    var dragover = ref(false);\n\n    function onDrop(e) {\n      var _a;\n\n      if (props.disabled || !uploader) return;\n      var accept = ((_a = uploader.props) == null ? void 0 : _a.accept) || uploader.accept;\n      dragover.value = false;\n\n      if (!accept) {\n        emit(\"file\", e.dataTransfer.files);\n        return;\n      }\n\n      emit(\"file\", Array.from(e.dataTransfer.files).filter(function (file) {\n        var type = file.type,\n            name = file.name;\n        var extension = name.indexOf(\".\") > -1 ? \".\".concat(name.split(\".\").pop()) : \"\";\n        var baseType = type.replace(/\\/.*$/, \"\");\n        return accept.split(\",\").map(function (type2) {\n          return type2.trim();\n        }).filter(function (type2) {\n          return type2;\n        }).some(function (acceptedType) {\n          if (acceptedType.startsWith(\".\")) {\n            return extension === acceptedType;\n          }\n\n          if (/\\/\\*$/.test(acceptedType)) {\n            return baseType === acceptedType.replace(/\\/\\*$/, \"\");\n          }\n\n          if (/^[^/]+\\/[^/]+$/.test(acceptedType)) {\n            return type === acceptedType;\n          }\n\n          return false;\n        });\n      }));\n    }\n\n    function onDragover() {\n      if (!props.disabled) dragover.value = true;\n    }\n\n    return {\n      ns: ns,\n      dragover: dragover,\n      onDrop: onDrop,\n      onDragover: onDragover\n    };\n  }\n});\n\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  return openBlock(), createElementBlock(\"div\", {\n    class: normalizeClass([_ctx.ns.b(\"dragger\"), _ctx.ns.is(\"dragover\", _ctx.dragover)]),\n    onDrop: _cache[0] || (_cache[0] = withModifiers(function () {\n      return _ctx.onDrop && _ctx.onDrop.apply(_ctx, arguments);\n    }, [\"prevent\"])),\n    onDragover: _cache[1] || (_cache[1] = withModifiers(function () {\n      return _ctx.onDragover && _ctx.onDragover.apply(_ctx, arguments);\n    }, [\"prevent\"])),\n    onDragleave: _cache[2] || (_cache[2] = withModifiers(function ($event) {\n      return _ctx.dragover = false;\n    }, [\"prevent\"]))\n  }, [renderSlot(_ctx.$slots, \"default\")], 34);\n}\n\nvar UploadDragger = /* @__PURE__ */_export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\n\nexport { UploadDragger as default };","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;AAgBA,IAAKA,YAAaC,gBAAa;AAC7BC,QAAM,cADuB;AAE7BC,SAAO;AACLC,cAAU;AACRC,YAAMC,OADE;AAERC,eAAS;AAFD;AADL,GAFsB;AAQ7BC,SAAO,CAAC,MAAD,CARsB;AAS7BC,OAT6B,iBASvBN,KATuB,QASN;AAAA,QAARO,IAAQ,QAARA,IAAQ;AACrB,QAAMC,WAAWC,OAAO,UAAP,EAAmB,EAAnB,CAAjB;AACA,QAAMC,KAAKC,aAAa,QAAb,CAAX;AACA,QAAMC,WAAWC,IAAI,KAAJ,CAAjB;;AAEA,oBAAgBC,CAAhB,EAA8B;AAC5B,UAAIC,EAAJ;;AAAiC,uCACjC;AACA,qBAAiBA,mBAAjB,KAAiB,IAAjB,GAAiB,MAAjB,GAAiBA,SAAjB,KAAiBP,eAAjB;AACAI;;AACE;AACAL;AAAA;AAEF;;AAGIA,+BAAuB,aAAvB,CAAuBS,KAAvB,EAAuBC,MAAvB,CAAuB;AACvB,YAAMf,IAAN,GACOgB,IADP,CAAMhB,IAAN;AAAA,YAAMH,IAAN,GACOmB,IADP,CAAMnB,IAAN;AAEA,YAAMoB,gBAAgB,QAAhB,CAAwB,GAAxB,IAAwB,CAAS,CAAjC,cAAiCpB,qBAAjC,IAAiC,EAAvC;AACA,oBACG,gBACK,OADL,EACK,EADL,CADH;AAKI,4BAAiB,GAAjB,EAAiBqB,GAAjB,CAAiB,UAAWC,KAAX;AAAA,iBAAWA,YAAX;AAAA,SAAjB,EAA4BJ,MAA5B,CAA4B;AAAA;AAAA,SAA5B,EAA4BK,IAA5B,CAA4B;AAC1B;AAAqB;AAEvB;;AACE;AAAkD;AAEpD;;AACE;AAAgB;AAElB;;AAAO;AAAA,SATP;AASO,OAlBX;AAwBN;;AACE;AAAqB,iBAASrB,QAAT,EAAiBW;AAGxC;;AAAO;AAELF,YAFK;AAGLE,wBAHK;AAILW,oBAJK;AAILC;AAJK;AAIL;AAzDyB,CAAb,CAAlB;;2CARQC;AAAA,gDANsB;AACzBC,wFADyB;AAEzBH;AAAA,iBAAkB,OAAlB,IAAkBI,kCAAlB;AAAA,OAAkB,WAAlB,EAFyB;AAGzBH;AAAA,aAAmBG,yDAAnB;AAAA,OAAmB,WAAnB,EAHyB;AAGEC;AAAA;AAAA;AAHF,GAMtB,GADSC,mCACT","names":["_sfc_main","defineComponent","name","props","disabled","type","Boolean","default","emits","setup","emit","uploader","inject","ns","useNamespace","dragover","ref","e","_a","files","filter","file","extension","map","type2","some","onDrop","onDragover","$setup","class","_ctx","onDragleave","renderSlot"],"sources":["../../../../../../packages/components/upload/src/upload-dragger.vue"],"sourcesContent":["<template>\n  <div\n    :class=\"[ns.b('dragger'), ns.is('dragover', dragover)]\"\n    @drop.prevent=\"onDrop\"\n    @dragover.prevent=\"onDragover\"\n    @dragleave.prevent=\"dragover = false\"\n  >\n    <slot></slot>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, ref, inject } from 'vue'\nimport { useNamespace } from '@element-plus/hooks'\n\nimport type { ElUpload } from './upload.type'\n\nexport default defineComponent({\n  name: 'ElUploadDrag',\n  props: {\n    disabled: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['file'],\n  setup(props, { emit }) {\n    const uploader = inject('uploader', {} as ElUpload)\n    const ns = useNamespace('upload')\n    const dragover = ref(false)\n\n    function onDrop(e: DragEvent) {\n      if (props.disabled || !uploader) return\n      const accept = uploader.props?.accept || uploader.accept\n      dragover.value = false\n      if (!accept) {\n        emit('file', e.dataTransfer.files)\n        return\n      }\n      emit(\n        'file',\n        Array.from(e.dataTransfer.files).filter((file) => {\n          const { type, name } = file\n          const extension =\n            name.indexOf('.') > -1 ? `.${name.split('.').pop()}` : ''\n          const baseType = type.replace(/\\/.*$/, '')\n          return accept\n            .split(',')\n            .map((type) => type.trim())\n            .filter((type) => type)\n            .some((acceptedType) => {\n              if (acceptedType.startsWith('.')) {\n                return extension === acceptedType\n              }\n              if (/\\/\\*$/.test(acceptedType)) {\n                return baseType === acceptedType.replace(/\\/\\*$/, '')\n              }\n              if (/^[^/]+\\/[^/]+$/.test(acceptedType)) {\n                return type === acceptedType\n              }\n              return false\n            })\n        })\n      )\n    }\n\n    function onDragover() {\n      if (!props.disabled) dragover.value = true\n    }\n\n    return {\n      ns,\n      dragover,\n      onDrop,\n      onDragover,\n    }\n  },\n})\n</script>\n"]},"metadata":{},"sourceType":"module"}