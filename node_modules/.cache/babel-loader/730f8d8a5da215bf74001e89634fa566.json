{"ast":null,"code":"import { ref, computed, watch, nextTick, onMounted } from 'vue';\nimport { isNumber, useTimeoutFn, isClient } from '@vueuse/core';\nimport '../../../hooks/index.mjs';\nimport '../../../constants/index.mjs';\nimport '../../../utils/index.mjs';\nimport { useZIndex } from '../../../hooks/use-z-index/index.mjs';\nimport { UPDATE_MODEL_EVENT } from '../../../constants/event.mjs';\nimport { useLockscreen } from '../../../hooks/use-lockscreen/index.mjs';\nimport { useModal } from '../../../hooks/use-modal/index.mjs';\nimport { useRestoreActive } from '../../../hooks/use-restore-active/index.mjs';\n\nvar useDialog = function useDialog(props, _ref, targetRef) {\n  var emit = _ref.emit;\n  var lastPosition = \"\";\n  var visible = ref(false);\n  var closed = ref(false);\n  var rendered = ref(false);\n\n  var _useZIndex = useZIndex(),\n      nextZIndex = _useZIndex.nextZIndex;\n\n  var zIndex = ref(props.zIndex || nextZIndex());\n  var openTimer = void 0;\n  var closeTimer = void 0;\n  var normalizeWidth = computed(function () {\n    return isNumber(props.width) ? \"\".concat(props.width, \"px\") : props.width;\n  });\n  var style = computed(function () {\n    var style2 = {};\n    var varPrefix = \"--el-dialog\";\n\n    if (!props.fullscreen) {\n      if (props.top) {\n        style2[\"\".concat(varPrefix, \"-margin-top\")] = props.top;\n      }\n\n      if (props.width) {\n        style2[\"\".concat(varPrefix, \"-width\")] = normalizeWidth.value;\n      }\n    }\n\n    return style2;\n  });\n\n  function afterEnter() {\n    emit(\"opened\");\n  }\n\n  function afterLeave() {\n    emit(\"closed\");\n    emit(UPDATE_MODEL_EVENT, false);\n\n    if (props.destroyOnClose) {\n      rendered.value = false;\n    }\n  }\n\n  function beforeLeave() {\n    emit(\"close\");\n  }\n\n  function open() {\n    closeTimer == null ? void 0 : closeTimer();\n    openTimer == null ? void 0 : openTimer();\n\n    if (props.openDelay && props.openDelay > 0) {\n      ;\n\n      var _useTimeoutFn = useTimeoutFn(function () {\n        return doOpen();\n      }, props.openDelay);\n\n      openTimer = _useTimeoutFn.stop;\n    } else {\n      doOpen();\n    }\n  }\n\n  function close() {\n    openTimer == null ? void 0 : openTimer();\n    closeTimer == null ? void 0 : closeTimer();\n\n    if (props.closeDelay && props.closeDelay > 0) {\n      ;\n\n      var _useTimeoutFn2 = useTimeoutFn(function () {\n        return doClose();\n      }, props.closeDelay);\n\n      closeTimer = _useTimeoutFn2.stop;\n    } else {\n      doClose();\n    }\n  }\n\n  function hide(shouldCancel) {\n    if (shouldCancel) return;\n    closed.value = true;\n    visible.value = false;\n  }\n\n  function handleClose() {\n    if (props.beforeClose) {\n      props.beforeClose(hide);\n    } else {\n      close();\n    }\n  }\n\n  function onModalClick() {\n    if (props.closeOnClickModal) {\n      handleClose();\n    }\n  }\n\n  function doOpen() {\n    if (!isClient) {\n      return;\n    }\n\n    visible.value = true;\n  }\n\n  function doClose() {\n    visible.value = false;\n  }\n\n  if (props.lockScroll) {\n    useLockscreen(visible);\n  }\n\n  if (props.closeOnPressEscape) {\n    useModal({\n      handleClose: handleClose\n    }, visible);\n  }\n\n  useRestoreActive(visible);\n  watch(function () {\n    return props.modelValue;\n  }, function (val) {\n    if (val) {\n      closed.value = false;\n      open();\n      rendered.value = true;\n      emit(\"open\");\n      zIndex.value = props.zIndex ? zIndex.value++ : nextZIndex();\n      nextTick(function () {\n        if (targetRef.value) {\n          targetRef.value.scrollTop = 0;\n        }\n      });\n    } else {\n      if (visible.value) {\n        close();\n      }\n    }\n  });\n  watch(function () {\n    return props.fullscreen;\n  }, function (val) {\n    if (!targetRef.value) return;\n\n    if (val) {\n      lastPosition = targetRef.value.style.transform;\n      targetRef.value.style.transform = \"\";\n    } else {\n      targetRef.value.style.transform = lastPosition;\n    }\n  });\n  onMounted(function () {\n    if (props.modelValue) {\n      visible.value = true;\n      rendered.value = true;\n      open();\n    }\n  });\n  return {\n    afterEnter: afterEnter,\n    afterLeave: afterLeave,\n    beforeLeave: beforeLeave,\n    handleClose: handleClose,\n    onModalClick: onModalClick,\n    close: close,\n    doClose: doClose,\n    closed: closed,\n    style: style,\n    rendered: rendered,\n    visible: visible,\n    zIndex: zIndex\n  };\n};\n\nexport { useDialog };","map":{"version":3,"mappings":"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","names":["useDialog","props","targetRef","emit","lastPosition","visible","ref","closed","rendered","useZIndex","nextZIndex","zIndex","openTimer","closeTimer","normalizeWidth","computed","isNumber","width","style","style2","varPrefix","fullscreen","top","value","afterEnter","afterLeave","UPDATE_MODEL_EVENT","destroyOnClose","beforeLeave","open","openDelay","useTimeoutFn","doOpen","stop","close","closeDelay","doClose","hide","shouldCancel","handleClose","beforeClose","onModalClick","closeOnClickModal","isClient","lockScroll","useLockscreen","closeOnPressEscape","useModal","useRestoreActive","watch","modelValue","val","nextTick","scrollTop","transform","onMounted"],"sources":["../../../../../../packages/components/dialog/src/use-dialog.ts"],"sourcesContent":["import { computed, ref, watch, nextTick, onMounted } from 'vue'\nimport { useTimeoutFn, isClient } from '@vueuse/core'\n\nimport {\n  useLockscreen,\n  useRestoreActive,\n  useModal,\n  useZIndex,\n} from '@element-plus/hooks'\nimport { UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport { isNumber } from '@element-plus/utils'\n\nimport type { CSSProperties, Ref, SetupContext } from 'vue'\nimport type { DialogEmits, DialogProps } from './dialog'\n\nexport const useDialog = (\n  props: DialogProps,\n  { emit }: SetupContext<DialogEmits>,\n  targetRef: Ref<HTMLElement | undefined>\n) => {\n  let lastPosition = ''\n  const visible = ref(false)\n  const closed = ref(false)\n  const rendered = ref(false) // when desctroyOnClose is true, we initialize it as false vise versa\n  const { nextZIndex } = useZIndex()\n  const zIndex = ref(props.zIndex || nextZIndex())\n\n  let openTimer: (() => void) | undefined = undefined\n  let closeTimer: (() => void) | undefined = undefined\n\n  const normalizeWidth = computed(() =>\n    isNumber(props.width) ? `${props.width}px` : props.width\n  )\n\n  const style = computed<CSSProperties>(() => {\n    const style: CSSProperties = {}\n    const varPrefix = `--el-dialog`\n    if (!props.fullscreen) {\n      if (props.top) {\n        style[`${varPrefix}-margin-top`] = props.top\n      }\n      if (props.width) {\n        style[`${varPrefix}-width`] = normalizeWidth.value\n      }\n    }\n    return style\n  })\n\n  function afterEnter() {\n    emit('opened')\n  }\n\n  function afterLeave() {\n    emit('closed')\n    emit(UPDATE_MODEL_EVENT, false)\n    if (props.destroyOnClose) {\n      rendered.value = false\n    }\n  }\n\n  function beforeLeave() {\n    emit('close')\n  }\n\n  function open() {\n    closeTimer?.()\n    openTimer?.()\n\n    if (props.openDelay && props.openDelay > 0) {\n      ;({ stop: openTimer } = useTimeoutFn(() => doOpen(), props.openDelay))\n    } else {\n      doOpen()\n    }\n  }\n\n  function close() {\n    // if (this.willClose && !this.willClose()) return;\n    openTimer?.()\n    closeTimer?.()\n\n    if (props.closeDelay && props.closeDelay > 0) {\n      ;({ stop: closeTimer } = useTimeoutFn(() => doClose(), props.closeDelay))\n    } else {\n      doClose()\n    }\n  }\n\n  function hide(shouldCancel: boolean) {\n    if (shouldCancel) return\n    closed.value = true\n    visible.value = false\n  }\n\n  function handleClose() {\n    if (props.beforeClose) {\n      props.beforeClose(hide)\n    } else {\n      close()\n    }\n  }\n\n  function onModalClick() {\n    if (props.closeOnClickModal) {\n      handleClose()\n    }\n  }\n\n  function doOpen() {\n    if (!isClient) {\n      return\n    }\n\n    // if (props.willOpen?.()) {\n    //  return\n    // }\n    visible.value = true\n  }\n\n  function doClose() {\n    visible.value = false\n  }\n\n  if (props.lockScroll) {\n    useLockscreen(visible)\n  }\n\n  if (props.closeOnPressEscape) {\n    useModal(\n      {\n        handleClose,\n      },\n      visible\n    )\n  }\n\n  useRestoreActive(visible)\n\n  watch(\n    () => props.modelValue,\n    (val) => {\n      if (val) {\n        closed.value = false\n        open()\n        rendered.value = true // enables lazy rendering\n        emit('open')\n        zIndex.value = props.zIndex ? zIndex.value++ : nextZIndex()\n        // this.$el.addEventListener('scroll', this.updatePopper)\n        nextTick(() => {\n          if (targetRef.value) {\n            targetRef.value.scrollTop = 0\n          }\n        })\n      } else {\n        // this.$el.removeEventListener('scroll', this.updatePopper\n        if (visible.value) {\n          close()\n        }\n      }\n    }\n  )\n\n  watch(\n    () => props.fullscreen,\n    (val) => {\n      if (!targetRef.value) return\n      if (val) {\n        lastPosition = targetRef.value.style.transform\n        targetRef.value.style.transform = ''\n      } else {\n        targetRef.value.style.transform = lastPosition\n      }\n    }\n  )\n\n  onMounted(() => {\n    if (props.modelValue) {\n      visible.value = true\n      rendered.value = true // enables lazy rendering\n      open()\n    }\n  })\n\n  return {\n    afterEnter,\n    afterLeave,\n    beforeLeave,\n    handleClose,\n    onModalClick,\n    close,\n    doClose,\n    closed,\n    style,\n    rendered,\n    visible,\n    zIndex,\n  }\n}\n"]},"metadata":{},"sourceType":"module"}